!function(e,t,s,n,a){var r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},l="function"==typeof r.parcelRequire5ce4&&r.parcelRequire5ce4,o=l.cache||{},i="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function u(t,s){if(!o[t]){if(!e[t]){var n="function"==typeof r.parcelRequire5ce4&&r.parcelRequire5ce4;if(!s&&n)return n(t,!0);if(l)return l(t,!0);if(i&&"string"==typeof t)return i(t);var a=new Error("Cannot find module '"+t+"'");throw a.code="MODULE_NOT_FOUND",a}p.resolve=function(s){return e[t][1][s]||s},p.cache={};var d=o[t]=new u.Module(t);e[t][0].call(d.exports,p,d,d.exports,this)}return o[t].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=o,u.parent=l,u.register=function(t,s){e[t]=[function(e,t){t.exports=s},{}]},Object.defineProperty(u,"root",{get:function(){return r.parcelRequire5ce4}}),r.parcelRequire5ce4=u;for(var d=0;d<t.length;d++)u(t[d]);var p=u(s);"object"==typeof exports&&"undefined"!=typeof module?module.exports=p:"function"==typeof define&&define.amd&&define((function(){return p}))}({"2VTMI":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"router",(function(){return L}));var a=e("./pages/login"),r=e("./pages/login/index.tmpl"),l=n.interopDefault(r),o=e("./pages/signup"),i=e("./pages/signup/index.tmpl"),u=n.interopDefault(i),d=e("./pages/profile"),p=e("./pages/profile/index.tmpl"),c=n.interopDefault(p),f=e("./pages/messenger"),m=e("./pages/messenger/index.tmpl"),h=n.interopDefault(m),v=e("./pages/errorPage"),g=n.interopDefault(v),b=e("./pages/errorPage/index.tmpl"),y=n.interopDefault(b);e("./index.scss");var j=e("./utils/classes/Router"),D=n.interopDefault(j),w=e("./store/Store"),C=e("./components/Messages"),k=n.interopDefault(C),x=e("./components/popups/ChatUserListPopup"),B=n.interopDefault(x),I=e("./components/popups/ChatUserAddPopup"),F=n.interopDefault(I);const P={"/":{Class:f.Messenger,props:f.messengerProps,value:null,tmpl:h.default,isProtected:!0,listenedStoreField:["chats","activeChat","updateMessenger"]},"/login":{Class:a.Login,props:a.loginProps,value:null,tmpl:l.default,isProtected:!1,listenedStoreField:[]},"/sign-up":{Class:o.Signup,props:o.signupProps,value:null,tmpl:u.default,isProtected:!1,listenedStoreField:[]},"/settings":{Class:d.Profile,props:d.profileProps,value:null,tmpl:c.default,isProtected:!0,listenedStoreField:["userData"]}},L=new D.default("#root");Object.keys(P).forEach((e=>{const{Class:t,props:s,tmpl:n,isProtected:a,listenedStoreField:r}=P[e],l=new t(s,n);L.use(e,l,a),r.forEach((e=>{const t=l.setProps.bind(l);w.storeEventBus.on(e,t)}))})),w.storeEventBus.on("activeChatMessages",k.default.setProps.bind(k.default)),w.storeEventBus.on("activeChatUsers",B.default.setProps.bind(B.default)),w.storeEventBus.on("searchUserList",F.default.setProps.bind(F.default)),L.use("errorPage",new g.default({error:{code:"404",message:"Страница не существует"}},y.default),!1),L.start()},{"./pages/login":"3nYzq","./pages/login/index.tmpl":"6l5XE","./pages/signup":"tOoNo","./pages/signup/index.tmpl":"5n8U4","./pages/profile":"43pLp","./pages/profile/index.tmpl":"7IFjV","./pages/messenger":"1Mk1Z","./pages/messenger/index.tmpl":"d2HmX","./pages/errorPage":"1zU4o","./pages/errorPage/index.tmpl":"6FZfd","./index.scss":"5iJih","./utils/classes/Router":"2GTux","./store/Store":"4xi7r","./components/Messages":"2M7ZJ","./components/popups/ChatUserListPopup":"2TlYL","./components/popups/ChatUserAddPopup":"33Q4c","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"3nYzq":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"submitButton",(function(){return C})),n.export(s,"Login",(function(){return k})),n.export(s,"loginProps",(function(){return x}));var a=e("../../components/DefaultInput/index"),r=n.interopDefault(a),l=e("../../components/DefaultInput/index.tmpl"),o=n.interopDefault(l),i=e("../../components/Button/index"),u=n.interopDefault(i),d=e("../../components/Button/index.tmpl"),p=n.interopDefault(d),c=e("../../utils/classes/Validation"),f=n.interopDefault(c),m=e("../../modules/Form"),h=n.interopDefault(m),v=e("../../index"),g=e("../../controllers/AuthController"),b=n.interopDefault(g),y=e("../../utils/functions/getObjFromFormData"),j=n.interopDefault(y);const D=new r.default({label:"Login",type:"text",name:"login",errorText:"Wrong login",events:[{type:"blur",element:"input",callback(e){const t=e.target,{isValid:s}=new f.default(t.value).minLength(4);s?D.setValid():D.setValidError()}}]},o.default),w=new r.default({label:"Password",type:"password",name:"password",errorText:"Wrong password",events:[{type:"blur",element:"input",callback(){w.setValid()}}]},o.default),C=new u.default({attributes:[{element:"root",disabled:{type:"set",value:!0},className:{type:"add",value:"disabled"}}],type:"submit",text:"Login"},p.default);class k extends h.default{}const x={events:[{type:"submit",element:"form",callback(e){const t=e.target;e.preventDefault(),b.default.signIn(j.default(new FormData(t))),t.reset()}},{type:"click",element:"[data-path]",callback(e){const t=e.target,{path:s}=t.dataset;v.router.go(s)}}],components:{loginInput:D,passwordInput:w,submitButton:C}}},{"../../components/DefaultInput/index":"5xxXy","../../components/DefaultInput/index.tmpl":"7CCL9","../../components/Button/index":"o32bC","../../components/Button/index.tmpl":"30wYB","../../utils/classes/Validation":"5y01V","../../modules/Form":"3PPs5","../../index":"2VTMI","../../controllers/AuthController":"4WQRY","../../utils/functions/getObjFromFormData":"5kw0O","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5xxXy":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{get input(){return this.element.querySelector("input")}setValidError(){var e;this.input.dataset.valid="false",null===(e=this.element.querySelector("[data-validation-error]"))||void 0===e||e.classList.add("visible"),this.props.checkFormValid()}setValid(){var e;this.input.dataset.valid="true",null===(e=this.element.querySelector("[data-validation-error]"))||void 0===e||e.classList.remove("visible"),this.props.checkFormValid()}}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],GBKa8:[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a,r=e("../../utils/classes/EventBus"),l=n.interopDefault(r),o=e("../../utils/classes/Templator"),i=n.interopDefault(o);!function(e){e.INIT="init",e.FLOW_CDM="flow:component-did-mount",e.FLOW_CDU="flow:component-did-update",e.FLOW_RENDER="flow:render"}(a||(a={}));s.default=class{constructor(e={},t){this._boundEvents=[],this.eventBus=new l.default,this._meta={tmpl:t,props:e},this.props=this._makeProxy({...e}),this._registerEvents(),this.eventBus.emit(a.INIT)}get element(){return this._element}destroy(){this.element.remove()}create(){this.eventBus.emit(a.INIT)}getContent(){return this.element}setProps=e=>{e&&Object.assign(this.props,{...e})};render(){return i.default.getCompiledChildren(this._meta.tmpl,this.props)}componentDidMount(){}init(){this._createResources(),this.eventBus.emit(a.FLOW_CDM)}componentDidUpdate(e,t){return e!==t}show(){this.getContent().classList.remove("hidden")}hide(){this.getContent().classList.add("hidden")}_registerEvents(){this.eventBus.on(a.INIT,this.init.bind(this)),this.eventBus.on(a.FLOW_CDM,this._componentDidMount.bind(this)),this.eventBus.on(a.FLOW_CDU,this._componentDidUpdate.bind(this)),this.eventBus.on(a.FLOW_RENDER,this._render.bind(this))}_createResources(){this._element=i.default.getCompiledParent(this._meta.tmpl,this.props)}_makeProxy(e){return new Proxy(e,{get:(e,t)=>{const s=e[t];return"function"==typeof s?s.bind(e):s},set:(e,t,s)=>("object"==typeof e[t]&&"events"===t?Object.assign(e[t],s):e[t]=s,this.eventBus.emit(a.FLOW_CDU,{...e},e),!0),deleteProperty:()=>{throw new Error("Нет доступа")}})}_componentDidMount(){this.componentDidMount(),this.eventBus.emit(a.FLOW_RENDER)}_componentDidUpdate(e,t){this.componentDidUpdate(e,t)&&this._render()}addEvents(){this._boundEvents.forEach((({type:e,element:t,callback:s})=>{if(t)if("root"===t){this.element.addEventListener(e,s)}else{this.element.querySelectorAll(t).forEach((t=>{t.addEventListener(e,s)}))}}))}removeEvents(){this._boundEvents.forEach((({type:e,element:t,callback:s})=>{if(!t)return;let n;"root"===t?(n=this.element,n.removeEventListener(e,s)):(n=this.element.querySelectorAll(t),n.forEach((t=>{t.removeEventListener(e,s)})))})),this.props.events&&(this._boundEvents=[],this.props.events.forEach((({type:e,element:t,callback:s})=>{this._boundEvents.push({type:e,element:t,callback:s.bind(this)})})))}setAttributes(e){if(void 0!==this.props.attributes)return this.props.attributes.forEach((t=>{let s=e;"root"!==t.element&&(s=e.querySelector(t.element)),null!==s&&Object.keys(t).forEach((e=>{if("element"!==e)if("className"===e){var n,a;const r=null===(n=t[e])||void 0===n?void 0:n.type,l=null===(a=t[e])||void 0===a?void 0:a.value;void 0!==r&&void 0!==l&&s.classList[r](l)}else{const n=t[e],{type:a,value:r}=n;"set"===a?s.setAttribute(e,r):"remove"===a&&s.removeAttribute(e)}}))})),e}_render(){const e=this.render();e.length&&(this._element.innerHTML="",this._element.append(...e)),this.removeEvents(),this.setAttributes(this._element),this.addEvents(),this.afterRender()}forceUpdate(){this.eventBus.emit(a.INIT)}afterRender(){}}},{"../../utils/classes/EventBus":"3ppPn","../../utils/classes/Templator":"6VyJz","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"3ppPn":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s);s.default=class{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]=this.listeners[e].filter((e=>e!==t))}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((e=>{e(...t)}))}}},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"730v8":[function(e,t,s){"use strict";s.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},s.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.exportAll=function(e,t){return Object.keys(e).forEach((function(s){"default"!==s&&"__esModule"!==s&&(s in t&&t[s]===e[s]||Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[s]}}))})),t},s.export=function(e,t,s){Object.defineProperty(e,t,{enumerable:!0,get:s})}},{}],"6VyJz":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../functions/get"),r=n.interopDefault(a);const l={compile(e,t={}){let s=e;return Array.from(e.matchAll(/{{(.*?)}}/gi)).forEach((e=>{const n=e[1].trim(),a=r.default(t,n);let l;if(n.includes(".time")){const e=new Date(a),t=new Date;l=e.toDateString()===t.toDateString()?new Date(a).toLocaleTimeString().slice(0,-3):new Date(a).toLocaleDateString()}else l=null==a?"":a;s=s.replace(new RegExp(e[0],"gi"),l)})),s},getCompiledParent(e,t){const s=this.compile(e,t),n=(new DOMParser).parseFromString(s,"text/html").body.children[0];return n.children.length&&(n.innerHTML=""),n},getCompiledChildren(e,t){return this.compileToHtml(e,t).children},compileToHtml(e,t){let s=e;s=this.compile(s,t);const n=(new DOMParser).parseFromString(s,"text/html").body.children[0];return t.components&&n.querySelectorAll("[data-component]").forEach((e=>{if(void 0!==t.components&&e instanceof HTMLElement){const s=t.components[e.dataset.component];if(void 0!==s)if(Array.isArray(s)){const t=document.createDocumentFragment();t.append(...s.map((e=>e.getContent()))),e.replaceWith(t)}else e.replaceWith(s.getContent())}})),n}};s.default=l},{"../functions/get":"4191x","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4191x":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("./isPlainObject"),r=n.interopDefault(a);s.default=function(e,t,s){const n=t.split(".");let a=e[n[0]];if(void 0===a)return a;if(r.default(a))for(let e=1;e<n.length;e++){if(void 0===a[n[e]]){a=s||void 0;break}a=a[n[e]]}return a}},{"./isPlainObject":"4ImsX","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4ImsX":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default=function(e){return"object"==typeof e&&null!==e&&e.constructor===Object&&"[object Object]"===Object.prototype.toString.call(e)}},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"7CCL9":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='input-wrap'>\n    <span class='label'>{{label}}</span>\n    <input data-valid='false' name='{{name}}' class='input' type='{{type}}' value=\"{{value}}\"/>\n    <span data-validation-error class='error'>{{errorText}}</span>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],o32bC:[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{get button(){return this.element.querySelector("button")}}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"30wYB":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="<button type='{{type}}' class='button'>{{text}}</button>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5y01V":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"checkValidationByTemplate",(function(){return d}));const a=/^[a-z]+$/i,r=/^\d+$/,l=/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/,o=/^\S+@\S+\.\S+$/,i=/[0-9]/;class u{isValid=!0;constructor(e){this.value=e}email(){return this.isValid=o.test(this.value)&&this.isValid,this}required(){return this.isValid=!!this.value.length&&this.isValid,this}maxLength(e){return this.isValid=this.value.length<=e&&this.isValid,this}minLength(e){return this.isValid=this.value.length>=e&&this.isValid,this}onlyLetters(){return this.isValid=a.test(this.value)&&this.isValid,this}onlyNumbers(){return this.isValid=r.test(this.value)&&this.isValid,this}phone(){return this.isValid=l.test(this.value)&&this.isValid,this}lettersOrNumbers(){return this.isValid=i.test(this.value)&&this.isValid,this}}function d(e,t){const s=new u(t);let n;switch(e){case"email":n=s.email().isValid;break;case"login":n=s.minLength(4).lettersOrNumbers().isValid;break;case"first_name":case"second_name":n=s.minLength(2).onlyLetters().isValid;break;case"phone":n=s.phone().isValid;break;case"password":n=s.minLength(6).lettersOrNumbers().isValid;break;default:n=!1}return n}s.default=u},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"3PPs5":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("./Block/Block"),r=n.interopDefault(a);class l extends r.default{constructor(e,t){super(e,t),this.props.components&&Object.keys(this.props.components).forEach((e=>{if(void 0!==this.props.components){const t=this.props.components[e];Array.isArray(t)?t.forEach((e=>{e.setProps({checkFormValid:this.checkFormValid.bind(this)})})):t.setProps({checkFormValid:this.checkFormValid.bind(this)})}}))}get submitButton(){return this.element.querySelector("button")}checkFormValid(){const e=this.element.querySelectorAll("input");let t=!0;e.forEach((e=>{t="true"===e.dataset.valid&&t})),t?(this.submitButton.classList.remove("disabled"),this.submitButton.removeAttribute("disabled")):(this.submitButton.classList.add("disabled"),this.submitButton.setAttribute("disabled","true"))}}s.default=l},{"./Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4WQRY":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../api/AuthApi"),r=n.interopDefault(a),l=e("../index"),o=e("../store/Store"),i=n.interopDefault(o),u=e("../utils/functions/deepEncodeHTML"),d=n.interopDefault(u);class p{static signUp(e){r.default.signUp(JSON.stringify(d.default(e))).then((()=>{p.getUser((()=>{l.router.go("/")}))})).catch((e=>{const t=e,{reason:s}=JSON.parse(t.response);"Login already exists"===s&&alert(s)}))}static getUser(e){r.default.getUser().then((t=>{i.default.userData=d.default(JSON.parse(t.response)),void 0!==e&&e()})).catch((()=>{i.default.userData={...o.storeUserInitial.userData},l.router.go("/login")}))}static checkUserLoggedIn(){return r.default.getUser()}static signIn(e){r.default.signIn(JSON.stringify(d.default(e))).then((e=>{"OK"===e.response&&p.getUser((()=>{l.router.go("/")}))})).catch((e=>{const t=e,{reason:s}=JSON.parse(t.response);"User already in system"===s?p.getUser((()=>{l.router.go("/")})):alert(s)}))}static logout(){r.default.logout().then((()=>{l.router.go("/login")}))}}s.default=p},{"../api/AuthApi":"5TsWN","../index":"2VTMI","../store/Store":"4xi7r","../utils/functions/deepEncodeHTML":"6EZWZ","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5TsWN":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../utils/classes/HTTP");const r=new(n.interopDefault(a).default)("https://ya-praktikum.tech/api/v2/auth");s.default=class{static signUp(e){return r.post("/signup",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static signIn(e){return r.post("/signin",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static getUser(){return r.get("/user",{withCredentials:!0})}static logout(){return r.post("/logout",{withCredentials:!0,headers:{"content-type":"application/json"}})}}},{"../utils/classes/HTTP":"1Cfkm","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"1Cfkm":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../functions/queryStringify"),r=n.interopDefault(a);const l="GET",o="POST",i="PUT",u="DELETE";s.default=class{constructor(e){this.url=e}get=(e,t={})=>this.request(e,{...t,method:l},t.timeout);post=(e,t={})=>this.request(e,{...t,method:o},t.timeout);put=(e,t={})=>this.request(e,{...t,method:i},t.timeout);delete=(e,t={})=>this.request(e,{...t,method:u},t.timeout);request=(e,t={},s=5e3)=>{const{headers:n={},method:a,data:o,withCredentials:i}=t;return new Promise(((t,u)=>{if(!a)return void u(new Error("No method"));const d=new XMLHttpRequest,p=a===l;d.withCredentials=!!i,d.open(a,p&&o?`${this.url+e}${r.default(o)}`:this.url+e),Object.keys(n).forEach((e=>{d.setRequestHeader(e,n[e])})),d.onload=()=>{d.status>=200&&d.status<300?t(d):d.status>=400&&d.status<500&&u(d)},d.onabort=u,d.onerror=u,d.timeout=s,d.ontimeout=u,p||!o?d.send():d.send(o)}))}}},{"../functions/queryStringify":"5Kqjm","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5Kqjm":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("./isPlainObject"),r=n.interopDefault(a);function l(e){return r.default(e)||Array.isArray(e)}function o(e,t){return t?`${t}[${e}]`:e}function i(e,t){const s=[];for(const[n,a]of Object.entries(e))l(a)?s.push(...i(a,o(n,t))):s.push([o(n,t),encodeURIComponent(String(a))]);return s}s.default=function(e){if(!r.default(e))throw new Error("input must be an object");return i(e).map((e=>e.join("="))).join("&")}},{"./isPlainObject":"4ImsX","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4xi7r":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"storeUserInitial",(function(){return i})),n.export(s,"storeEventBus",(function(){return d}));var a=e("../utils/classes/EventBus"),r=n.interopDefault(a),l=e("../utils/functions/isPlainObject"),o=n.interopDefault(l);const i={updateMessenger:!1,userData:{id:null,first_name:"",second_name:"",login:"",email:"",phone:"",display_name:"",avatar:e("../constants/urls").defaultAvatar},chats:[],activeChat:{},searchUserInput:"",activeChatUsers:[],searchUserList:[],activeChatMessages:[],activeChatAvatar:""},u=i,d=new r.default,p=new Proxy(u,{get:(e,t)=>{const s=e[t];return"function"==typeof s?s.bind(e):s},set:(e,t,s)=>(o.default(s)?e[t]={...s}:e[t]=s,d.emit(t,{...p}),!0)});s.default=p},{"../utils/classes/EventBus":"3ppPn","../utils/functions/isPlainObject":"4ImsX","../constants/urls":"LTDzS","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],LTDzS:[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"resourcesUrl",(function(){return a})),n.export(s,"defaultAvatar",(function(){return r}));const a="https://ya-praktikum.tech/api/v2/resources",r="https://ya-praktikum.tech/api/v2/resources//a16d7fcd-f5fa-468e-afd6-3f9666999c8b/073c838f-acdb-4d84-8edd-1d5313cd02a7_profile.jpg"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"6EZWZ":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("./isPlainObject"),r=n.interopDefault(a),l=e("./encodeHTML"),o=n.interopDefault(l);s.default=function e(t){let s=t;if("string"==typeof t&&(s=o.default(t)),Array.isArray(t)&&(s=t.map((t=>e(t)))),r.default(t)&&(s={},"object"==typeof t))for(const n in t)t.hasOwnProperty(n)&&(t instanceof Array||(s[n]=e(t[n])));return s}},{"./isPlainObject":"4ImsX","./encodeHTML":"Jfxkn","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],Jfxkn:[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5kw0O":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default=function(e){const t={};return e.forEach(((e,s)=>{t[s]=e})),t}},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"6l5XE":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='form login-wrap'>\n    <h1>Log in</h1>\n    <form>\n      <div data-component='loginInput'></div>\n      <div data-component='passwordInput'></div>\n      <div data-component='submitButton'></div>\n    </form>\n    <div class='pre-link'>Don't have an account? <a data-path='/sign-up' class='link'> Sign up</a></div>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],tOoNo:[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"Signup",(function(){return P})),n.export(s,"signupProps",(function(){return L}));var a=e("../../components/DefaultInput"),r=n.interopDefault(a),l=e("../../components/Button"),o=n.interopDefault(l),i=e("../../components/Button/index.tmpl"),u=n.interopDefault(i),d=e("../../components/DefaultInput/index.tmpl"),p=n.interopDefault(d),c=e("../../utils/classes/Validation"),f=n.interopDefault(c),m=e("../../index"),h=e("../../modules/Form"),v=n.interopDefault(h),g=e("../../controllers/AuthController"),b=n.interopDefault(g),y=e("../../utils/functions/getObjFromFormData"),j=n.interopDefault(y);const D=new r.default({label:"Email",type:"text",name:"email",errorText:"Wrong email",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value),{isValid:n}=s.email();n?D.setValid():D.setValidError()}}]},p.default),w=new r.default({label:"Login",type:"text",name:"login",errorText:"Wrong login",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value),{isValid:n}=s.minLength(4).lettersOrNumbers();n?w.setValid():w.setValidError()}}]},p.default),C=new r.default({label:"First name",type:"text",name:"first_name",errorText:"Wrong first name",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value),{isValid:n}=s.minLength(2).onlyLetters();n?C.setValid():C.setValidError()}}]},p.default),k=new r.default({label:"Second name",type:"text",name:"second_name",errorText:"Wrong second name",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value),{isValid:n}=s.minLength(2).onlyLetters();n?k.setValid():k.setValidError()}}]},p.default),x=new r.default({label:"Phone number",type:"number",name:"phone",errorText:"Wrong phone number",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value),{isValid:n}=s.phone();n?x.setValid():x.setValidError()}}]},p.default),B=new r.default({label:"Password",type:"password",name:"password",errorText:"Wrong password",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value),{isValid:n}=s.minLength(6).lettersOrNumbers();n?B.setValid():B.setValidError()}}]},p.default),I=new r.default({label:"Password (again)",type:"password",name:"passwordAgain",errorText:"Password mismatch",events:[{type:"blur",element:"input",callback(e){const t=e.target,s=new f.default(t.value);let{isValid:n}=s.minLength(6).lettersOrNumbers();const a=document.querySelector("[name=password]");null!==a&&(n=n&&a.value===t.value),n?I.setValid():I.setValidError()}}]},p.default),F=new o.default({attributes:[{element:"root",disabled:{type:"set",value:!0},className:{type:"add",value:"disabled"}}],type:"submit",text:"Sign up"},u.default);class P extends v.default{}const L={events:[{type:"submit",element:"form",callback(e){e.preventDefault(),b.default.signUp(j.default(new FormData(e.target)))}},{type:"click",element:"[data-path]",callback(e){const t=e.target,{path:s}=t.dataset;m.router.go(s)}}],components:{emailInput:D,loginInput:w,firstNameInput:C,secondNameInput:k,phoneInput:x,passwordInput:B,passwordAgainInput:I,submitBtn:F}}},{"../../components/DefaultInput":"5xxXy","../../components/Button":"o32bC","../../components/Button/index.tmpl":"30wYB","../../components/DefaultInput/index.tmpl":"7CCL9","../../utils/classes/Validation":"5y01V","../../index":"2VTMI","../../modules/Form":"3PPs5","../../controllers/AuthController":"4WQRY","../../utils/functions/getObjFromFormData":"5kw0O","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5n8U4":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='form signup-wrap'>\n    <h1>Sign up</h1>\n    <form>\n      <div data-component='emailInput'></div>\n      <div data-component='loginInput'></div>\n      <div data-component='firstNameInput'></div>\n      <div data-component='secondNameInput'></div>\n      <div data-component='phoneInput'></div>\n      <div data-component='passwordInput'></div>\n      <div data-component='passwordAgainInput'></div>\n      <div data-component='submitBtn'></div>\n    </form>\n    <div class='pre-link'>Already have an account? <a data-path='/login' class='link'> Log in</a></div>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"43pLp":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"Profile",(function(){return U})),n.export(s,"profileProps",(function(){return S}));var a=e("../../components/ArrowButton/index"),r=n.interopDefault(a),l=e("../../components/ArrowButton/index.tmpl"),o=n.interopDefault(l),i=e("../../modules/Block/Block"),u=n.interopDefault(i),d=e("../../index"),p=e("../../components/popups/FormPopup/index.tmpl"),c=n.interopDefault(p),f=e("../../components/DefaultInput"),m=n.interopDefault(f),h=e("../../components/DefaultInput/index.tmpl"),v=n.interopDefault(h),g=e("../../components/Button"),b=n.interopDefault(g),y=e("../../components/Button/index.tmpl"),j=n.interopDefault(y),D=e("../../utils/classes/Validation"),w=e("../../controllers/AuthController"),C=n.interopDefault(w),k=e("../../store/Store"),x=n.interopDefault(k),B=e("../../controllers/UserContoller"),I=n.interopDefault(B),F=e("../../utils/functions/getObjFromFormData"),P=n.interopDefault(F),L=e("../../components/popups/FormPopup"),_=n.interopDefault(L);const E=new r.default({attributes:[{element:"root",className:{type:"add",value:"to-left"}},{element:"root","data-path":{type:"set",value:"/"}}],events:[{type:"click",element:"root",callback(e){const t=e.target,{path:s}=t.dataset;d.router.go(s)}}]},o.default);class U extends u.default{componentDidMount(){C.default.getUser()}}const S={components:{arrowBtn:E},events:[{type:"click",element:"[data-field]",callback(e){!function(e){const{userData:t}=x.default,s=t[e],n="password"===e||"avatar"===e;let a={};const r=new b.default({type:"submit",text:"confirm edit"},j.default);if(n){if("password"===e){const t=new m.default({label:"Old password",type:"password",name:"oldPassword",errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(s){const n=s.target;D.checkValidationByTemplate(e,n.value),t.setValid()}}]},v.default),s=new m.default({label:"New password",type:"password",name:"newPassword",errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(t){const n=t.target;D.checkValidationByTemplate(e,n.value),s.setValid()}}]},v.default);a={formElements:[t,s,r]}}else if("avatar"===e){const t=new m.default({label:e.charAt(0).toUpperCase()+e.slice(1),type:"file",name:e,errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(s){const n=s.target;D.checkValidationByTemplate(e,n.value),t.setValid()}}]},v.default);a={formElements:[t,r]}}}else{const t=new m.default({label:e.charAt(0).toUpperCase()+e.slice(1),type:"text",value:s,name:e,errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(s){const n=s.target;D.checkValidationByTemplate(e,n.value),t.setValid()}}]},v.default);a={formElements:[t,r]}}const l=new _.default({title:"Редактировать поле",components:a,events:[{type:"submit",element:"form",callback(t){if(t.preventDefault(),n)if("password"===e){const{oldPassword:e,newPassword:s}=P.default(new FormData(t.target));I.default.updateUserPassword(e,s)}else"avatar"===e&&I.default.updateProfileAvatar(new FormData(t.target)).then((()=>{C.default.getUser()})).catch((()=>{alert(`Не удалось обновить поле ${e}`)}));else{const s={...x.default.userData,...P.default(new FormData(t.target))};I.default.updateProfile(s).then((()=>{C.default.getUser()})).catch((()=>{alert(`Не удалось обновить поле ${e}`)}))}this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},c.default);document.body.append(l.getContent())}(e.target.dataset.field)}},{type:"click",element:"[data-logout]",callback(){C.default.logout()}}]}},{"../../components/ArrowButton/index":"4JYAe","../../components/ArrowButton/index.tmpl":"3VsRK","../../modules/Block/Block":"GBKa8","../../index":"2VTMI","../../components/popups/FormPopup/index.tmpl":"7rZP2","../../components/DefaultInput":"5xxXy","../../components/DefaultInput/index.tmpl":"7CCL9","../../components/Button":"o32bC","../../components/Button/index.tmpl":"30wYB","../../utils/classes/Validation":"5y01V","../../controllers/AuthController":"4WQRY","../../store/Store":"4xi7r","../../controllers/UserContoller":"70rjz","../../utils/functions/getObjFromFormData":"5kw0O","../../components/popups/FormPopup":"2rSr2","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4JYAe":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"3VsRK":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("url:../../../static/img/arrow.svg");const r=`\n  <div class='arrow-button'>\n    <img src='${n.interopDefault(a).default}' alt=''/>\n  </div>`;s.default=r},{"url:../../../static/img/arrow.svg":"4jfWw","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4jfWw":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"arrow.586565a4.svg"},{"./bundle-url":"YkqCo"}],YkqCo:[function(e,t,s){"use strict";var n=null;function a(e){return(""+e).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}s.getBundleURL=function(){return n||(n=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return a(e[0])}return"/"}()),n},s.getBaseURL=a,s.getOrigin=function(e){let t=(""+e).match(/(https?|file|ftp):\/\/[^/]+/);if(!t)throw new Error("Origin not found");return t[0]}},{}],"7rZP2":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='popup-wrap'>\n    <div class='popup'>\n      <div class='close-popup'>+</div>\n      <div class='title'>{{title}}</div>\n      <form>\n        <div data-component='formElements'></div>\n      </form>\n    </div>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"70rjz":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../api/UserApi"),r=n.interopDefault(a),l=e("../store/Store"),o=n.interopDefault(l),i=e("../utils/functions/deepEncodeHTML"),u=n.interopDefault(i);s.default=class{static updateProfile(e){return r.default.updateProfile(JSON.stringify(u.default(e)))}static updateProfileAvatar(e){return r.default.updateProfileAvatar(e)}static updateUserPassword(e,t){r.default.updateUserPassword(JSON.stringify(u.default({oldPassword:e,newPassword:t})))}static getUserById(e){r.default.getUserById(e)}static searchUsersByLogin(e){r.default.searchUsersByLogin(JSON.stringify(u.default({login:e}))).then((e=>JSON.parse(e.response))).then((e=>{o.default.searchUserList=u.default(e)}))}}},{"../api/UserApi":"2ZGGD","../store/Store":"4xi7r","../utils/functions/deepEncodeHTML":"6EZWZ","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"2ZGGD":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../utils/classes/HTTP");const r=new(n.interopDefault(a).default)("https://ya-praktikum.tech/api/v2/user");s.default=class{static updateProfile(e){return r.put("/profile",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static updateProfileAvatar(e){return r.put("/profile/avatar",{data:e,withCredentials:!0})}static updateUserPassword(e){return r.put("/password",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static getUserById(e){return r.get(`/${e}`,{withCredentials:!0})}static searchUsersByLogin(e){return r.post("/search",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}}},{"../utils/classes/HTTP":"1Cfkm","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"2rSr2":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../../modules/Form"),r=n.interopDefault(a);class l extends r.default{}s.default=l},{"../../../modules/Form":"3PPs5","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"7IFjV":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='profile-wrap'>\n    <div class='sidebar'>\n      <div data-component='arrowBtn'></div>\n    </div>\n    <div class='profile'>\n      <div class='img-wrap'>\n        <img data-field='avatar' src='https://ya-praktikum.tech/api/v2/resources/{{userData.avatar}}' alt='avatar' class='profile-img'>\n      </div>\n      <h3>{{userData.display_name}}</h3>\n      <div class='row'>\n        <p data-field='email' class='field-name'>Email</p>\n        <p class='field-value'>{{userData.email}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='login' class='field-name'>Login</p>\n        <p class='field-value'>{{userData.login}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='password' class='field-name'>Password</p>\n        <p class='field-value'>••••••••••••</p>\n      </div>\n      <div class='row'>\n        <p data-field='first_name' class='field-name'>First name</p>\n        <p class='field-value'>{{userData.first_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='second_name' class='field-name'>Second name</p>\n        <p class='field-value'>{{userData.second_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='display_name' class='field-name'>Display name</p>\n        <p class='field-value'>{{userData.display_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='phone' class='field-name'>Phone number</p>\n        <p class='field-value'>{{userData.phone}}</p>\n      </div>\n      <a data-logout class='link warning'>log out</a>\n    </div>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"1Mk1Z":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s),n.export(s,"Messenger",(function(){return K})),n.export(s,"messengerProps",(function(){return G}));var a=e("../../modules/Block/Block"),r=n.interopDefault(a),l=e("../../components/ArrowButton"),o=n.interopDefault(l),i=e("../../components/ArrowButton/index.tmpl"),u=n.interopDefault(i),d=e("../../components/DefaultInput"),p=n.interopDefault(d),c=e("../../components/DefaultInput/index.tmpl"),f=n.interopDefault(c),m=e("../../components/searchInput/index.tmpl"),h=n.interopDefault(m),v=e("../../index"),g=e("../../controllers/ChatsController"),b=n.interopDefault(g),y=e("../../components/popups/FormPopup"),j=n.interopDefault(y),D=e("../../components/popups/FormPopup/index.tmpl"),w=n.interopDefault(D),C=e("../../utils/functions/getObjFromFormData"),k=n.interopDefault(C),x=e("../../store/Store"),B=n.interopDefault(x),I=e("../../components/Button"),F=n.interopDefault(I),P=e("../../components/Button/index.tmpl"),L=n.interopDefault(P),_=e("../../components/ChatItem"),E=n.interopDefault(_),U=e("../../components/ChatItem/index.tmpl"),S=n.interopDefault(U),T=e("../../utils/classes/Templator"),V=n.interopDefault(T),O=e("../../api/ChatsApi"),A=n.interopDefault(O),R=e("../../api/MessageApi"),M=n.interopDefault(R),N=e("../../components/Messages"),$=n.interopDefault(N),q=e("../../components/popups/ChatUserListPopup"),H=n.interopDefault(q),J=e("../../utils/functions/encodeHTML"),W=n.interopDefault(J),Y=e("../../utils/functions/deepEncodeHTML"),X=n.interopDefault(Y);const Z=new o.default({},u.default);class K extends r.default{sendMessage(e){this.props.socket.send(JSON.stringify({content:W.default(e),type:"message"}))}componentDidMount(){b.default.getChats(0,20)}render(){const e=this.props.chats.map((e=>new E.default({},S.default(e))));return V.default.getCompiledChildren(this._meta.tmpl,{...this.props,activeChatAvatar:B.default.activeChat.avatar?"":"empty",components:{...this.props.components,chatList:e}})}afterRender(){var e,t,s;null!==(e=B.default.activeChat)&&void 0!==e&&e.id||(null===(t=this.element.querySelector(".empty-chat"))||void 0===t||t.classList.remove("hidden"),null===(s=this.element.querySelector(".chat-content-wrap"))||void 0===s||s.classList.add("hidden"))}}const G={chats:[],chatAvatarClass:"empty",events:[{type:"click",element:"[data-path]",callback(e){const t=e.target,{path:s}=t.dataset;v.router.go(s)}},{type:"click",element:".settings-btn",callback(){var e;null===(e=document.querySelector(".settings-popup"))||void 0===e||e.classList.toggle("hidden")}},{type:"click",element:".add-chat-btn",callback(){!function(){const e=new F.default({type:"submit",text:"create"},L.default),t=new p.default({label:"Chat name",type:"text",name:"title",errorText:"Wrong chat name",events:[{type:"blur",element:"input",callback(){t.setValid()}}]},f.default),s=new j.default({title:"Create chat",components:{formElements:[t,e]},events:[{type:"submit",element:"form",callback(e){e.preventDefault(),b.default.createChat(k.default(new FormData(e.target)).title),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},w.default);document.body.append(s.getContent())}()}},{type:"click",element:".controls .arrow-button",callback(){this.sendMessage(this.element.querySelector(".controls input").value),this.element.querySelector(".controls input").value="",b.default.getChats()}},{type:"click",element:"[data-action]",callback(e){const t=e.currentTarget,{action:s}=t.dataset;"deleteChat"===s?function(e){const t=new F.default({type:"submit",text:"delete"},L.default),s=new j.default({title:`Confirm deleting chat ${e.title}`,components:{formElements:[t]},events:[{type:"submit",element:"form",callback(t){t.preventDefault(),b.default.deleteChat(e.id),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},w.default);document.body.append(s.getContent())}(B.default.activeChat):"chatAvatarUpdate"===s?function(e){const t=new F.default({type:"submit",text:"update"},L.default),s=new p.default({type:"hidden",name:"chatId",value:e},f.default),n=new p.default({label:"",type:"file",name:"avatar"},f.default),a=new j.default({title:"Update chat avatar",components:{formElements:[s,n,t]},events:[{type:"submit",element:"form",callback(e){e.preventDefault(),b.default.updateChatAvatar(new FormData(e.target)),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},w.default);document.body.append(a.getContent())}(B.default.activeChat.id):"chatUserList"===s&&document.body.append(H.default.getContent())}},{type:"click",element:".chat",callback(e){const t=e.currentTarget,{id:s}=t.dataset;void 0!==s&&+s!==B.default.activeChat.id&&(this.props.socket&&(this.props.socket.close(),B.default.activeChatMessages=[]),B.default.activeChat=B.default.chats.find((e=>e.id===+s)),b.default.getChatUsersById(+s),A.default.getToken(+s).then((e=>{console.log(JSON.parse(e.response));const{token:t}=JSON.parse(e.response),n=M.default.startChat(B.default.userData.id,+s,t);let a;n.addEventListener("open",(()=>{a=window.setInterval((()=>{n.send(JSON.stringify({type:"ping"}))}),2e3),b.default.getNewMessagesCount(B.default.activeChat.id).then((e=>JSON.parse(e.response))).then((e=>{n.send(JSON.stringify({content:e.unread_count,type:"get old"}))}))})),n.onmessage=e=>{const t=X.default(JSON.parse(e.data));if("pong"===t.type)return;const s=B.default.activeChatMessages.concat(t);s.sort(((e,t)=>+new Date(e.time)-+new Date(t.time))),B.default.activeChatMessages=s},n.addEventListener("close",(e=>{e.wasClean?console.log("Соединение закрыто чисто"):console.log("Обрыв соединения"),clearInterval(a),console.log(`Код: ${e.code} | Причина: ${e.reason}`)})),this.setProps({socket:n})})),this.setProps({activeChatAvatar:B.default.activeChat.avatar?"":"empty",attributes:[{element:".empty-chat",className:{type:"add",value:"hidden"}},{element:".chat-content-wrap",className:{type:"remove",value:"hidden"}}]}))}}],components:{messages:$.default,searchInput:new p.default({},h.default),messageInput:new p.default({attributes:[{element:"root",className:{type:"add",value:"fullwidth"}}]},f.default),arrowBtn:Z}}},{"../../modules/Block/Block":"GBKa8","../../components/ArrowButton":"4JYAe","../../components/ArrowButton/index.tmpl":"3VsRK","../../components/DefaultInput":"5xxXy","../../components/DefaultInput/index.tmpl":"7CCL9","../../components/searchInput/index.tmpl":"4Ykec","../../index":"2VTMI","../../controllers/ChatsController":"2EryD","../../components/popups/FormPopup":"2rSr2","../../components/popups/FormPopup/index.tmpl":"7rZP2","../../utils/functions/getObjFromFormData":"5kw0O","../../store/Store":"4xi7r","../../components/Button":"o32bC","../../components/Button/index.tmpl":"30wYB","../../components/ChatItem":"7coN3","../../components/ChatItem/index.tmpl":"3KWa8","../../utils/classes/Templator":"6VyJz","../../api/ChatsApi":"5O2bE","../../api/MessageApi":"6LZZT","../../components/Messages":"2M7ZJ","../../components/popups/ChatUserListPopup":"2TlYL","../../utils/functions/encodeHTML":"Jfxkn","../../utils/functions/deepEncodeHTML":"6EZWZ","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"4Ykec":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("url:../../../static/img/search.svg"),r=n.interopDefault(a);s.default=`\n  <div class='input-wrap'>\n    <img class='search-icon' src='${r.default}' alt=''>\n    <span class='label'>{{label}}</span>\n    <div class="input-inner-wrap">\n      <input data-valid='false' name='{{name}}' class='input search' type='{{type}}'/>\n    </div>\n    <span data-validation-error class='error'>{{errorText}}</span>\n  </div>`},{"url:../../../static/img/search.svg":"5V8e1","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5V8e1":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"search.2964ddfb.svg"},{"./bundle-url":"YkqCo"}],"2EryD":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../api/ChatsApi"),r=n.interopDefault(a),l=e("../store/Store"),o=n.interopDefault(l),i=e("../utils/functions/deepEncodeHTML"),u=n.interopDefault(i);class d{static getChats(e,t,s){const n={};e&&(n.offset=e),t&&(n.limit=t),s&&(n.title=s),r.default.getChats(n).then((e=>{var t;const s=u.default(JSON.parse(e.response));o.default.chats=s,null!==(t=o.default.activeChat)&&void 0!==t&&t.id&&(o.default.activeChat=s.find((e=>e.id===o.default.activeChat.id)))}))}static createChat(e){r.default.createChat(JSON.stringify(u.default({title:e}))).then((()=>{d.getChats()}))}static deleteChat(e){r.default.deleteChat(JSON.stringify(u.default({chatId:e}))).then((()=>{o.default.activeChat={},d.getChats()}))}static getChatUsersById(e,t){r.default.getChatUsersById(e,t).then((e=>{o.default.activeChatUsers=u.default(JSON.parse(e.response))}))}static getNewMessagesCount(e){return r.default.getNewMessagesCount(e)}static updateChatAvatar(e){r.default.updateChatAvatar(e).then((()=>{o.default.updateMessenger=!o.default.updateMessenger,d.getChats()}))}static addUsersToChatById(e,t){r.default.addUsersToChatById(JSON.stringify(u.default({chatId:e,users:t}))).then((()=>{alert("Пользователь добавлен"),d.getChats(),d.getChatUsersById(e)}))}static deleteUserFromChat(e,t){return r.default.deleteUserFromChat(JSON.stringify(u.default({chatId:e,users:t}))).then((()=>{d.getChats(),d.getChatUsersById(e)}))}}s.default=d},{"../api/ChatsApi":"5O2bE","../store/Store":"4xi7r","../utils/functions/deepEncodeHTML":"6EZWZ","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5O2bE":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../utils/classes/HTTP");const r=new(n.interopDefault(a).default)("https://ya-praktikum.tech/api/v2/chats");s.default=class{static getChats(e){return r.get("?",{data:e,withCredentials:!0})}static createChat(e){return r.post("/",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static deleteChat(e){return r.delete("/",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static getChatUsersById(e,t){return r.get(`/${e}/users`,{data:t,withCredentials:!0})}static getNewMessagesCount(e){return r.get(`/new/${e}`,{withCredentials:!0})}static updateChatAvatar(e){return r.put("/avatar",{data:e,withCredentials:!0})}static getToken(e){return r.post(`/token/${e}`,{withCredentials:!0})}static addUsersToChatById(e){return r.put("/users",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static deleteUserFromChat(e){return r.delete("/users",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}}},{"../utils/classes/HTTP":"1Cfkm","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"7coN3":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"3KWa8":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s);var n=e("../../constants/urls");s.default=({id:e,avatar:t,title:s,unread_count:a,last_message:r})=>{var l;let o;var i;null!=r&&null!==(l=r.user)&&void 0!==l&&l.display_name?o=`<span class='own-msg'>${null==r||null===(i=r.user)||void 0===i?void 0:i.display_name} :</span><span>${r.content}</span>`:o="<span class='own-msg'>Нет сообщений</span>";const u=null!=r&&r.time?new Date(r.time).toLocaleTimeString().slice(0,-3):"";return`\n  <div data-id="${e}" class='chat'>\n    <div class='img ${t||"empty"}'>\n      <img src="${n.resourcesUrl}${t}" alt="">\n    </div>\n    <div class='content'>\n      <div class='name'>${s}</div>\n      <div class='last-msg'> \n        ${o}\n      </div>\n      <div class='unread-msg-count-wrap'>${a}</div>\n      <div class='last-msg-date'>${u}</div>\n    </div>\n  </div>`}},{"../../constants/urls":"LTDzS","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"6LZZT":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s);s.default=class{static startChat(e,t,s){return new WebSocket(`wss://ya-praktikum.tech/ws/chats/${e}/${t}/${s}`)}}},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"2M7ZJ":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../store/Store"),r=n.interopDefault(a),l=e("../../modules/Block/Block"),o=n.interopDefault(l),i=e("../../utils/classes/Templator"),u=n.interopDefault(i),d=e("./index.tmpl"),p=n.interopDefault(d);class c extends o.default{render(){const e=this.props.activeChatMessages,t=new o.default({},`<div>${e.map((e=>p.default(e))).join()}</div>`);return u.default.getCompiledChildren(this._meta.tmpl,{...this.props,components:{...this.props.components,messages:t}})}}const f=new c({activeChatMessages:r.default.activeChatMessages},'<div><div data-component="messages"></div></div>');s.default=f},{"../../store/Store":"4xi7r","../../modules/Block/Block":"GBKa8","../../utils/classes/Templator":"6VyJz","./index.tmpl":"5VCXP","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5VCXP":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../store/Store"),r=n.interopDefault(a);s.default=({id:e,time:t,user_id:s,content:n})=>`\n    <div data-id='${e}' class='message ${+s===r.default.userData.id?"own":"other"}'>\n      <p class='text'>\n        ${n}\n      </p>\n      <div class='info'>\n        <div class='time'>${new Date(t).toLocaleTimeString().slice(0,-3)}</div>\n      </div>\n    </div>`},{"../../store/Store":"4xi7r","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"2TlYL":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../../modules/Form"),r=n.interopDefault(a),l=e("../../../constants/urls"),o=e("../../CloseCircleButton"),i=n.interopDefault(o),u=e("../../CloseCircleButton/index.tmpl"),d=n.interopDefault(u),p=e("../../../store/Store"),c=n.interopDefault(p),f=e("../../../modules/Block/Block"),m=n.interopDefault(f),h=e("../../PlusCircleButton"),v=n.interopDefault(h),g=e("../../PlusCircleButton/index.tmpl"),b=n.interopDefault(g),y=e("../../../utils/functions/getObjFromFormData"),j=n.interopDefault(y),D=e("./index.tmpl"),w=n.interopDefault(D),C=e("../../../utils/classes/Templator"),k=n.interopDefault(C),x=e("../../../controllers/ChatsController"),B=n.interopDefault(x),I=e("../ChatUserAddPopup"),F=n.interopDefault(I);const P=({id:e,first_name:t,second_name:s,avatar:n})=>`<div data-id="${e}" class="user-item">\n                          <div  class="user-info">\n                            <div class="user-avatar ${n||"empty"}"><img src="${l.resourcesUrl}${n||""}" alt=""></div>\n                            <div>${t} ${s}</div>\n                          </div>\n                          <div data-component="closeCircleButton"></div>\n                        </div>`,L=c.default.activeChatUsers.map((e=>new m.default({components:{closeCircleButton:new i.default({events:[{type:"click",element:"root",callback(e){const t=e.currentTarget.parentNode.dataset.id;B.default.deleteUserFromChat(c.default.activeChat.id,[+t])}}],attributes:[{element:"root",className:{type:"add",value:"delete-user-btn"}}]},d.default)}},P(e)))),_=new v.default({attributes:[{element:"root",className:{type:"add",value:"add-user-btn"}}]},b.default);class E extends r.default{render(){const e=this.props.activeChatUsers.map((e=>new m.default({components:{closeCircleButton:new i.default({events:[{type:"click",element:"root",callback(e){const t=e.currentTarget.parentNode.dataset.id;B.default.deleteUserFromChat(c.default.activeChat.id,[+t])}}],attributes:[{element:"root",className:{type:"add",value:"delete-user-btn"}}]},d.default)}},P(e))));return k.default.getCompiledChildren(this._meta.tmpl,{...this.props,components:{...this.props.components,userList:e}})}}const U=new E({activeChatUsers:c.default.activeChatUsers,title:"Список пользователей",components:{userList:L,plusBtn:_},attributes:[{element:"root",className:{type:"add",value:"user-list-popup"}}],events:[{type:"submit",element:"form",callback(e){e.preventDefault();const t=e.target,s=new FormData(t);console.log(j.default(s)),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}},{type:"click",element:".add-user-btn",callback(){document.body.append(F.default.getContent()),this.destroy()}}]},w.default);s.default=U},{"../../../modules/Form":"3PPs5","../../../constants/urls":"LTDzS","../../CloseCircleButton":"Vi0GF","../../CloseCircleButton/index.tmpl":"6Eeh6","../../../store/Store":"4xi7r","../../../modules/Block/Block":"GBKa8","../../PlusCircleButton":"3deP6","../../PlusCircleButton/index.tmpl":"1bzn7","../../../utils/functions/getObjFromFormData":"5kw0O","./index.tmpl":"6ka8h","../../../utils/classes/Templator":"6VyJz","../../../controllers/ChatsController":"2EryD","../ChatUserAddPopup":"33Q4c","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],Vi0GF:[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"6Eeh6":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("url:../../../static/img/close_circle.svg");const r=`\n  <div class='circle-button'>\n    <img src='${n.interopDefault(a).default}' alt=''/>\n  </div>`;s.default=r},{"url:../../../static/img/close_circle.svg":"qTu1n","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],qTu1n:[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"close_circle.eef96e8a.svg"},{"./bundle-url":"YkqCo"}],"3deP6":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"1bzn7":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("url:../../../static/img/plus_circle.svg");const r=`\n  <div class='circle-button'>\n    <img src='${n.interopDefault(a).default}' alt=''/>\n  </div>`;s.default=r},{"url:../../../static/img/plus_circle.svg":"I7XAS","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],I7XAS:[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"plus_circle.d1112072.svg"},{"./bundle-url":"YkqCo"}],"6ka8h":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='popup-wrap'>\n    <div class='popup'>\n      <div class='close-popup'>+</div>\n      <div class=\"title-wrap\">\n        <div class='title'>{{title}}</div>\n        <div data-component=\"plusBtn\"></div>\n      </div>\n      <form>\n        <div data-component='userList'></div>\n      </form>\n    </div>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"33Q4c":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../../modules/Form"),r=n.interopDefault(a),l=e("../../DefaultInput"),o=n.interopDefault(l),i=e("../../../controllers/UserContoller"),u=n.interopDefault(i),d=e("../../../store/Store"),p=n.interopDefault(d),c=e("../../searchInput/index.tmpl"),f=n.interopDefault(c),m=e("../../../constants/urls"),h=e("../../../modules/Block/Block"),v=n.interopDefault(h),g=e("../../../utils/functions/getObjFromFormData"),b=n.interopDefault(g),y=e("./index.tmpl"),j=n.interopDefault(y),D=e("../../../utils/classes/Templator"),w=n.interopDefault(D),C=e("../../Button"),k=n.interopDefault(C),x=e("../../Button/index.tmpl"),B=n.interopDefault(x),I=e("../../../controllers/ChatsController"),F=n.interopDefault(I);const P=new o.default({type:"text",name:"search",label:"Поиск пользователей",events:[{value:p.default.searchUserInput,type:"input",element:"input",callback(e){const t=e.target;u.default.searchUsersByLogin(t.value)}}]},f.default),L=new k.default({type:"submit",text:"добавить выбранных"},B.default),_=({id:e,first_name:t,second_name:s,avatar:n})=>`<div class="user-item">\n            <div class="user-info">\n              <div class="user-avatar"><img src="${m.resourcesUrl}${n||""}" alt=""></div>\n              <div>${t} ${s}</div>\n            </div>\n            <input name="user-${e}" type="checkbox">\n          </div>`,E=p.default.searchUserList.map((e=>new v.default({},_(e))));class U extends r.default{render(){const e=this.props.searchUserList.map((e=>new v.default({},_(e))));return w.default.getCompiledChildren(this._meta.tmpl,{...this.props,components:{...this.props.components,userList:e}})}afterRender(){var e;null===(e=this.element.querySelector("input"))||void 0===e||e.focus()}}const S=new U({searchUserList:[],title:"Добавить пользователей",components:{searchInput:P,userList:E,submitBtn:L},events:[{type:"submit",element:"form",callback(e){e.preventDefault();const t=e.target,s=new FormData(t),n=[];Object.keys(b.default(s)).forEach((e=>{e.includes("user-")&&n.push(+e.slice(5))})),F.default.addUsersToChatById(p.default.activeChat.id,n)}},{type:"click",element:".close-popup",callback(){p.default.searchUserList=[],p.default.searchUserInput="",this.destroy()}}]},j.default);s.default=S},{"../../../modules/Form":"3PPs5","../../DefaultInput":"5xxXy","../../../controllers/UserContoller":"70rjz","../../../store/Store":"4xi7r","../../searchInput/index.tmpl":"4Ykec","../../../constants/urls":"LTDzS","../../../modules/Block/Block":"GBKa8","../../../utils/functions/getObjFromFormData":"5kw0O","./index.tmpl":"7pp5C","../../../utils/classes/Templator":"6VyJz","../../Button":"o32bC","../../Button/index.tmpl":"30wYB","../../../controllers/ChatsController":"2EryD","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"7pp5C":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='popup-wrap'>\n    <div class='popup'>\n      <div class='close-popup'>+</div>\n      <div class='title'>{{title}}</div>\n      <form>\n        <div data-component='searchInput'></div>\n        <div data-component='userList'></div>\n        <div data-component='submitBtn'></div>\n      </form>\n    </div>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],d2HmX:[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("url:../../../static/img/plus.svg"),r=n.interopDefault(a),l=e("url:../../../static/img/dot-btn.svg"),o=n.interopDefault(l),i=e("url:../../../static/img/attach.svg"),u=n.interopDefault(i),d=e("url:../../../static/img/user-icon.svg"),p=n.interopDefault(d),c=e("url:../../../static/img/camera.svg"),f=n.interopDefault(c),m=e("url:../../../static/img/trash.svg"),h=n.interopDefault(m),v=e("url:../../../static/img/settings.svg"),g=n.interopDefault(v),b=e("../../constants/urls");s.default=`\n  <div class='chat-wrap'>\n    <div class='chat-list-wrap'>\n      <div class='controls-wrap'>\n        <button class='img-btn'>\n          <img data-path='/settings' src='${g.default}' alt='' />\n        </button>\n        <div class='search-input-wrap'>\n          <div data-component='searchInput'></div>\n        </div>\n        <button class='add-chat-btn img-btn'>\n          <img src='${r.default}' alt='' />\n        </button>\n      </div>\n      <div class='chat-list'>\n        <div data-component='chatList'></div>\n      </div>\n    </div>\n    <div class='chat-content-wrap hidden'>\n      <div class='header'>\n        <div class='chat-header'>\n          <div class='chat-img {{activeChatAvatar}}'><img src="${b.resourcesUrl}{{activeChat.avatar}}" alt=""></div>\n          <div class='chat-name'>{{activeChat.title}}</div>\n        </div>\n        <button class='settings-btn img-btn'>\n          <div class="settings-popup hidden">\n             <div data-action="chatUserList" class="item">\n               <div class="img-btn"><img src=${p.default} alt=""></div>\n               <div>Список пользователей</div>\n            </div>\n             <div data-action="chatAvatarUpdate" class="item">\n               <div class="img-btn"><img src=${f.default} alt=""></div>\n               <div>Изменить аватар чата</div>\n            </div>\n             <div data-action="deleteChat" class="item">\n               <div class="img-btn"><img src=${h.default} alt=""></div>\n               <div>Удалить чат</div>\n            </div>\n          </div>\n          <img src='${o.default}' alt='' />\n        </button>\n      </div>\n      <div class='content'>\n        <div class='messages'>\n          <div data-component='messages'></div>\n        </div>\n      </div>\n      <div class='controls'>\n        <button class='attach-btn img-btn'>\n          <img src='${u.default}' alt='' />\n        </button>\n        <div data-component='messageInput'></div>\n        <div data-component='arrowBtn'></div>\n      </div>\n    </div>\n    <div class='empty-chat'>Select chat to start messaging</div>\n  </div>`},{"url:../../../static/img/plus.svg":"1Xk0Q","url:../../../static/img/dot-btn.svg":"5d56m","url:../../../static/img/attach.svg":"6tb6D","url:../../../static/img/user-icon.svg":"62eOR","url:../../../static/img/camera.svg":"7IV6V","url:../../../static/img/trash.svg":"17XoD","url:../../../static/img/settings.svg":"3buKJ","../../constants/urls":"LTDzS","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"1Xk0Q":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"plus.094c9006.svg"},{"./bundle-url":"YkqCo"}],"5d56m":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"dot-btn.0efa3fab.svg"},{"./bundle-url":"YkqCo"}],"6tb6D":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"attach.582e70ed.svg"},{"./bundle-url":"YkqCo"}],"62eOR":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"user-icon.06e9290a.svg"},{"./bundle-url":"YkqCo"}],"7IV6V":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"camera.e6da0634.svg"},{"./bundle-url":"YkqCo"}],"17XoD":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"trash.c7952315.svg"},{"./bundle-url":"YkqCo"}],"3buKJ":[function(e,t,s){t.exports=e("./bundle-url").getBundleURL()+"settings.99d08653.svg"},{"./bundle-url":"YkqCo"}],"1zU4o":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../../modules/Block/Block"),r=n.interopDefault(a);class l extends r.default{}s.default=l},{"../../modules/Block/Block":"GBKa8","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"6FZfd":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default="\n  <div class='error-page-wrap'>\n    <h1 class='title'>{{error.code}}</h1>\n    <h3 class='message'>{{error.message}}</h3>\n    <a class='link'>Назад к чатам</a>\n  </div>"},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5iJih":[function(){},{}],"2GTux":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("./Route"),r=n.interopDefault(a),l=e("../../controllers/AuthController"),o=n.interopDefault(l);class i{routes=[];history=window.history;_currentRoute=null;_rootQuery="";constructor(e){if(i.__instance)return i.__instance;this._rootQuery=e,i.__instance=this}use(e,t,s){const n=new r.default(e,t,{rootQuery:this._rootQuery},s);return this.routes.push(n),this}getCurrentRoute(){return this._currentRoute}start(){window.onpopstate=e=>{if(null!==e.currentTarget){const t=e.currentTarget;this._onRoute(t.location.pathname)}},this._onRoute(window.location.pathname)}_onRoute(e){const t=this.getRoute(e)??this.getRoute("errorPage");this._currentRoute&&this._currentRoute.leave(),t.isProtected?o.default.checkUserLoggedIn().then((()=>{this._currentRoute=t,t.render()})).catch((()=>{this.go("/login")})):(this._currentRoute=t,t.render())}go(e){this.history.pushState({},"",e),this._onRoute(e)}back(){this.history.back()}forward(){this.history.forward()}getRoute(e){return this.routes.find((t=>t.pathname===e))}}s.default=i},{"./Route":"3sXva","../../controllers/AuthController":"4WQRY","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"3sXva":[function(e,t,s){var n=e("@parcel/transformer-js/lib/esmodule-helpers.js");n.defineInteropFlag(s);var a=e("../functions/renderDom"),r=n.interopDefault(a);s.default=class{init=!1;constructor(e,t,s,n){this.pathname=e,this._block=t,this._props=s,this.isProtected=n}navigate(e){e===this.pathname&&(this.pathname=e,this.render())}leave(){this._block.destroy()}render(){if(!this.init)return r.default(this._props.rootQuery,this._block),void(this.init=!0);this._block.create(),r.default(this._props.rootQuery,this._block)}}},{"../functions/renderDom":"5vcdF","@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}],"5vcdF":[function(e,t,s){e("@parcel/transformer-js/lib/esmodule-helpers.js").defineInteropFlag(s),s.default=function(e,t){document.querySelector(e).append(t.getContent())}},{"@parcel/transformer-js/lib/esmodule-helpers.js":"730v8"}]},["2VTMI"],"2VTMI");
//# sourceMappingURL=index.07463618.js.map

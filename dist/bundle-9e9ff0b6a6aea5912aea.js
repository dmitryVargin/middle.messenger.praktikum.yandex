(()=>{"use strict";var e={1500:(e,t,a)=>{a.r(t)},6108:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=new(s(a(4376)).default)("https://ya-praktikum.tech/api/v2/auth");t.default=class{static signUp(e){return n.post("/signup",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static signIn(e){return n.post("/signin",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static getUser(){return n.get("/user",{withCredentials:!0})}static logout(){return n.post("/logout",{withCredentials:!0,headers:{"content-type":"application/json"}})}}},581:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=new(s(a(4376)).default)("https://ya-praktikum.tech/api/v2/chats");t.default=class{static getChats(e){return n.get("?",{data:e,withCredentials:!0})}static createChat(e){return n.post("/",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static deleteChat(e){return n.delete("/",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static getChatUsersById(e,t){return n.get(`/${e}/users`,{data:t,withCredentials:!0})}static getNewMessagesCount(e){return n.get(`/new/${e}`,{withCredentials:!0})}static updateChatAvatar(e){return n.put("/avatar",{data:e,withCredentials:!0})}static getToken(e){return n.post(`/token/${e}`,{withCredentials:!0})}static addUsersToChatById(e){return n.put("/users",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static deleteUserFromChat(e){return n.delete("/users",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}}},5223:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{static startChat(e,t,a){return new WebSocket(`wss://ya-praktikum.tech/ws/chats/${e}/${t}/${a}`)}}},5527:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=new(s(a(4376)).default)("https://ya-praktikum.tech/api/v2/user");t.default=class{static updateProfile(e){return n.put("/profile",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static updateProfileAvatar(e){return n.put("/profile/avatar",{data:e,withCredentials:!0})}static updateUserPassword(e){return n.put("/password",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}static getUserById(e){return n.get(`/${e}`,{withCredentials:!0})}static searchUsersByLogin(e){return n.post("/search",{data:e,withCredentials:!0,headers:{"content-type":"application/json"}})}}},1197:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=`\n  <div class='arrow-button'>\n    <img src='${s(a(1427)).default}' alt=''/>\n  </div>`;t.default=n},6092:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{}t.default=i},9165:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="<button type='{{type}}' class='button'>{{text}}</button>"},9508:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{get button(){return this.element.querySelector("button")}}t.default=i},8854:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0});const s=a(525);t.default=({id:e,avatar:t,title:a,unread_count:n,last_message:i})=>{let r;r=i?.user?.display_name?`<span class='own-msg'>${i?.user?.display_name} :</span><span>${i.content}</span>`:"<span class='own-msg'>Нет сообщений</span>";const l=i?.time?new Date(i.time).toLocaleTimeString().slice(0,-3):"";return`\n  <div data-id="${e}" class='chat'>\n    <div class='img ${t||"empty"}'>\n      <img src="${s.resourcesUrl}${t}" alt="">\n    </div>\n    <div class='content'>\n      <div class='name'>${a}</div>\n      <div class='last-msg'> \n        ${r}\n      </div>\n      <div class='unread-msg-count-wrap'>${n}</div>\n      <div class='last-msg-date'>${l}</div>\n    </div>\n  </div>`}},7197:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{}t.default=i},7136:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=`\n  <div class='circle-button'>\n    <img src='${s(a(7114)).default}' alt=''/>\n  </div>`;t.default=n},985:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{}t.default=i},4169:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='input-wrap'>\n    <span class='label'>{{label}}</span>\n    <input data-valid='false' name='{{name}}' class='input' type='{{type}}' value=\"{{value}}\"/>\n    <span data-validation-error class='error'>{{errorText}}</span>\n  </div>"},5628:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{get input(){return this.element.querySelector("input")}setValidError(){this.input.dataset.valid="false",this.element.querySelector("[data-validation-error]")?.classList.add("visible"),this.props.checkFormValid()}setValid(){this.input.dataset.valid="true",this.element.querySelector("[data-validation-error]")?.classList.remove("visible"),this.props.checkFormValid()}}t.default=i},1402:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3365));t.default=({id:e,time:t,user_id:a,content:s})=>`\n    <div data-id='${e}' class='message ${+a===n.default.userData.id?"own":"other"}'>\n      <p class='text'>\n        ${s}\n      </p>\n      <div class='info'>\n        <div class='time'>${new Date(t).toLocaleTimeString().slice(0,-3)}</div>\n      </div>\n    </div>`},357:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3365)),i=s(a(3137)),r=s(a(2622)),l=s(a(1402));class o extends i.default{render(){const e=this.props.activeChatMessages,t=new i.default({},`<div>${e.map((e=>(0,l.default)(e))).join()}</div>`);return r.default.getCompiledChildren(this._meta.tmpl,{...this.props,components:{...this.props.components,messages:t}})}}const d=new o({activeChatMessages:n.default.activeChatMessages},'<div><div data-component="messages"></div></div>');t.default=d},515:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=`\n  <div class='circle-button'>\n    <img src='${s(a(5988)).default}' alt=''/>\n  </div>`;t.default=n},8317:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{}t.default=i},6549:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='popup-wrap'>\n    <div class='popup'>\n      <div class='close-popup'>+</div>\n      <div class='title'>{{title}}</div>\n      <form>\n        <div data-component='searchInput'></div>\n        <div data-component='userList'></div>\n        <div data-component='submitBtn'></div>\n      </form>\n    </div>\n  </div>"},6794:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(1422)),i=s(a(5628)),r=s(a(2209)),l=s(a(3365)),o=s(a(4856)),d=a(525),u=s(a(3137)),c=s(a(959)),p=s(a(6549)),f=s(a(2622)),h=s(a(9508)),m=s(a(9165)),v=s(a(2734)),g=new i.default({type:"text",name:"search",label:"Поиск пользователей",events:[{value:l.default.searchUserInput,type:"input",element:"input",callback(e){const t=e.target;r.default.searchUsersByLogin(t.value)}}]},o.default),_=new h.default({type:"submit",text:"добавить выбранных"},m.default),b=({id:e,first_name:t,second_name:a,avatar:s})=>`<div class="user-item">\n            <div class="user-info">\n              <div class="user-avatar"><img src="${d.resourcesUrl}${s||""}" alt=""></div>\n              <div>${t} ${a}</div>\n            </div>\n            <input name="user-${e}" type="checkbox">\n          </div>`,y=l.default.searchUserList.map((e=>new u.default({},b(e))));class w extends n.default{render(){const e=this.props.searchUserList.map((e=>new u.default({},b(e))));return f.default.getCompiledChildren(this._meta.tmpl,{...this.props,components:{...this.props.components,userList:e}})}afterRender(){this.element.querySelector("input")?.focus()}}const C=new w({searchUserList:[],title:"Добавить пользователей",components:{searchInput:g,userList:y,submitBtn:_},events:[{type:"submit",element:"form",callback(e){e.preventDefault();const t=e.target,a=new FormData(t),s=[];Object.keys((0,c.default)(a)).forEach((e=>{e.includes("user-")&&s.push(+e.slice(5))})),v.default.addUsersToChatById(l.default.activeChat.id,s)}},{type:"click",element:".close-popup",callback(){l.default.searchUserList=[],l.default.searchUserInput="",this.destroy()}}]},p.default);t.default=C},4491:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='popup-wrap'>\n    <div class='popup'>\n      <div class='close-popup'>+</div>\n      <div class=\"title-wrap\">\n        <div class='title'>{{title}}</div>\n        <div data-component=\"plusBtn\"></div>\n      </div>\n      <form>\n        <div data-component='userList'></div>\n      </form>\n    </div>\n  </div>"},2824:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(1422)),i=a(525),r=s(a(985)),l=s(a(7136)),o=s(a(3365)),d=s(a(3137)),u=s(a(8317)),c=s(a(515)),p=s(a(959)),f=s(a(4491)),h=s(a(2622)),m=s(a(2734)),v=s(a(6794)),g=({id:e,first_name:t,second_name:a,avatar:s})=>`<div data-id="${e}" class="user-item">\n                          <div  class="user-info">\n                            <div class="user-avatar ${s||"empty"}"><img src="${i.resourcesUrl}${s||""}" alt=""></div>\n                            <div>${t} ${a}</div>\n                          </div>\n                          <div data-component="closeCircleButton"></div>\n                        </div>`,_=o.default.activeChatUsers.map((e=>new d.default({components:{closeCircleButton:new r.default({events:[{type:"click",element:"root",callback(e){const t=e.currentTarget.parentNode.dataset.id;m.default.deleteUserFromChat(o.default.activeChat.id,[+t])}}],attributes:[{element:"root",className:{type:"add",value:"delete-user-btn"}}]},l.default)}},g(e)))),b=new u.default({attributes:[{element:"root",className:{type:"add",value:"add-user-btn"}}]},c.default);class y extends n.default{render(){const e=this.props.activeChatUsers.map((e=>new d.default({components:{closeCircleButton:new r.default({events:[{type:"click",element:"root",callback(e){const t=e.currentTarget.parentNode.dataset.id;m.default.deleteUserFromChat(o.default.activeChat.id,[+t])}}],attributes:[{element:"root",className:{type:"add",value:"delete-user-btn"}}]},l.default)}},g(e))));return h.default.getCompiledChildren(this._meta.tmpl,{...this.props,components:{...this.props.components,userList:e}})}}const w=new y({activeChatUsers:o.default.activeChatUsers,title:"Список пользователей",components:{userList:_,plusBtn:b},attributes:[{element:"root",className:{type:"add",value:"user-list-popup"}}],events:[{type:"submit",element:"form",callback(e){e.preventDefault();const t=e.target,a=new FormData(t);console.log((0,p.default)(a)),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}},{type:"click",element:".add-user-btn",callback(){document.body.append(v.default.getContent()),this.destroy()}}]},f.default);t.default=w},3307:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='popup-wrap'>\n    <div class='popup'>\n      <div class='close-popup'>+</div>\n      <div class='title'>{{title}}</div>\n      <form>\n        <div data-component='formElements'></div>\n      </form>\n    </div>\n  </div>"},3703:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(1422));class i extends n.default{}t.default=i},4856:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(4583));t.default=`\n  <div class='input-wrap'>\n    <img class='search-icon' src='${n.default}' alt=''>\n    <span class='label'>{{label}}</span>\n    <div class="input-inner-wrap">\n      <input data-valid='false' name='{{name}}' class='input search' type='{{type}}'/>\n    </div>\n    <span data-validation-error class='error'>{{errorText}}</span>\n  </div>`},525:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultAvatar=t.resourcesUrl=void 0,t.resourcesUrl="https://ya-praktikum.tech/api/v2/resources",t.defaultAvatar="https://ya-praktikum.tech/api/v2/resources//a16d7fcd-f5fa-468e-afd6-3f9666999c8b/073c838f-acdb-4d84-8edd-1d5313cd02a7_profile.jpg"},2707:function(e,t,a){var s=this&&this.__createBinding||(Object.create?function(e,t,a,s){void 0===s&&(s=a),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[a]}})}:function(e,t,a,s){void 0===s&&(s=a),e[s]=t[a]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&s(t,e,a);return n(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const l=r(a(6108)),o=a(3607),d=i(a(3365)),u=r(a(9099));class c{static signUp(e){l.default.signUp(JSON.stringify((0,u.default)(e))).then((()=>{c.getUser((()=>{o.router.go("/")}))})).catch((e=>{const t=e,{reason:a}=JSON.parse(t.response);"Login already exists"===a&&alert(a)}))}static getUser(e){l.default.getUser().then((t=>{d.default.userData=(0,u.default)(JSON.parse(t.response)),void 0!==e&&e()})).catch((()=>{d.default.userData={...d.storeUserInitial.userData},o.router.go("/login")}))}static checkUserLoggedIn(){return l.default.getUser()}static signIn(e){l.default.signIn(JSON.stringify((0,u.default)(e))).then((e=>{"OK"===e.response&&c.getUser((()=>{o.router.go("/")}))})).catch((e=>{const t=e,{reason:a}=JSON.parse(t.response);"User already in system"===a?c.getUser((()=>{o.router.go("/")})):alert(a)}))}static logout(){l.default.logout().then((()=>{o.router.go("/login")}))}}t.default=c},2734:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(581)),i=s(a(3365)),r=s(a(9099));class l{static getChats(e,t,a){const s={};e&&(s.offset=e),t&&(s.limit=t),a&&(s.title=a),n.default.getChats(s).then((e=>{const t=(0,r.default)(JSON.parse(e.response));i.default.chats=t,i.default.activeChat?.id&&(i.default.activeChat=t.find((e=>e.id===i.default.activeChat.id)))}))}static createChat(e){n.default.createChat(JSON.stringify((0,r.default)({title:e}))).then((()=>{l.getChats()}))}static deleteChat(e){n.default.deleteChat(JSON.stringify((0,r.default)({chatId:e}))).then((()=>{i.default.activeChat={},l.getChats()}))}static getChatUsersById(e,t){n.default.getChatUsersById(e,t).then((e=>{i.default.activeChatUsers=(0,r.default)(JSON.parse(e.response))}))}static getNewMessagesCount(e){return n.default.getNewMessagesCount(e)}static updateChatAvatar(e){n.default.updateChatAvatar(e).then((()=>{i.default.updateMessenger=!i.default.updateMessenger,l.getChats()}))}static addUsersToChatById(e,t){n.default.addUsersToChatById(JSON.stringify((0,r.default)({chatId:e,users:t}))).then((()=>{alert("Пользователь добавлен"),l.getChats(),l.getChatUsersById(e)}))}static deleteUserFromChat(e,t){return n.default.deleteUserFromChat(JSON.stringify((0,r.default)({chatId:e,users:t}))).then((()=>{l.getChats(),l.getChatUsersById(e)}))}}t.default=l},2209:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(5527)),i=s(a(3365)),r=s(a(9099));t.default=class{static updateProfile(e){return n.default.updateProfile(JSON.stringify((0,r.default)(e)))}static updateProfileAvatar(e){return n.default.updateProfileAvatar(e)}static updateUserPassword(e,t){n.default.updateUserPassword(JSON.stringify((0,r.default)({oldPassword:e,newPassword:t})))}static getUserById(e){n.default.getUserById(e)}static searchUsersByLogin(e){n.default.searchUsersByLogin(JSON.stringify((0,r.default)({login:e}))).then((e=>JSON.parse(e.response))).then((e=>{i.default.searchUserList=(0,r.default)(e)}))}}},3607:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.router=void 0;const n=a(8071),i=s(a(531)),r=a(5170),l=s(a(5394)),o=a(2448),d=s(a(993)),u=a(780),c=s(a(7466)),p=s(a(3204)),f=s(a(1804));a(1500);const h=s(a(8320)),m=a(3365),v=s(a(357)),g=s(a(2824)),_=s(a(6794)),b={"/":{Class:u.Messenger,props:u.messengerProps,value:null,tmpl:c.default,isProtected:!0,listenedStoreField:["chats","activeChat","updateMessenger"]},"/login":{Class:n.Login,props:n.loginProps,value:null,tmpl:i.default,isProtected:!1,listenedStoreField:[]},"/sign-up":{Class:r.Signup,props:r.signupProps,value:null,tmpl:l.default,isProtected:!1,listenedStoreField:[]},"/settings":{Class:o.Profile,props:o.profileProps,value:null,tmpl:d.default,isProtected:!0,listenedStoreField:["userData"]}};t.router=new h.default("#root"),Object.keys(b).forEach((e=>{const{Class:a,props:s,tmpl:n,isProtected:i,listenedStoreField:r}=b[e],l=new a(s,n);t.router.use(e,l,i),r.forEach((e=>{const t=l.setProps.bind(l);m.storeEventBus.on(e,t)}))})),m.storeEventBus.on("activeChatMessages",v.default.setProps.bind(v.default)),m.storeEventBus.on("activeChatUsers",g.default.setProps.bind(g.default)),m.storeEventBus.on("searchUserList",_.default.setProps.bind(_.default)),t.router.use("errorPage",new p.default({error:{code:"404",message:"Страница не существует"},events:[{type:"click",element:"[data-path]",callback(e){const a=e.target,{path:s}=a.dataset;t.router.go(s)}}]},f.default),!1),t.router.start()},3137:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3460)),i=s(a(2622));var r;!function(e){e.INIT="init",e.FLOW_CDM="flow:component-did-mount",e.FLOW_CDU="flow:component-did-update",e.FLOW_RENDER="flow:render"}(r||(r={})),t.default=class{props;_meta;eventBus;_boundEvents;constructor(e={},t){this._boundEvents=[],this.eventBus=new n.default,this._meta={tmpl:t,props:e},this.props=this._makeProxy({...e}),this._registerEvents(),this.eventBus.emit(r.INIT)}_element;get element(){return this._element}destroy(){this.element.remove()}create(){this.eventBus.emit(r.INIT)}getContent(){return this.element}setProps=e=>{e&&Object.assign(this.props,{...e})};render(){return i.default.getCompiledChildren(this._meta.tmpl,this.props)}componentDidMount(){}init(){this._createResources(),this.eventBus.emit(r.FLOW_CDM)}componentDidUpdate(e,t){return e!==t}show(){this.getContent().classList.remove("hidden")}hide(){this.getContent().classList.add("hidden")}_registerEvents(){this.eventBus.on(r.INIT,this.init.bind(this)),this.eventBus.on(r.FLOW_CDM,this._componentDidMount.bind(this)),this.eventBus.on(r.FLOW_CDU,this._componentDidUpdate.bind(this)),this.eventBus.on(r.FLOW_RENDER,this._render.bind(this))}_createResources(){this._element=i.default.getCompiledParent(this._meta.tmpl,this.props)}_makeProxy(e){return new Proxy(e,{get:(e,t)=>{const a=e[t];return"function"==typeof a?a.bind(e):a},set:(e,t,a)=>("object"==typeof e[t]&&"events"===t?Object.assign(e[t],a):e[t]=a,this.eventBus.emit(r.FLOW_CDU,{...e},e),!0),deleteProperty:()=>{throw new Error("Нет доступа")}})}_componentDidMount(){this.componentDidMount(),this.eventBus.emit(r.FLOW_RENDER)}_componentDidUpdate(e,t){this.componentDidUpdate(e,t)&&this._render()}addEvents(){this._boundEvents.forEach((({type:e,element:t,callback:a})=>{t&&("root"===t?this.element.addEventListener(e,a):this.element.querySelectorAll(t).forEach((t=>{t.addEventListener(e,a)})))}))}removeEvents(){this._boundEvents.forEach((({type:e,element:t,callback:a})=>{if(!t)return;let s;"root"===t?(s=this.element,s.removeEventListener(e,a)):(s=this.element.querySelectorAll(t),s.forEach((t=>{t.removeEventListener(e,a)})))})),this.props.events&&(this._boundEvents=[],this.props.events.forEach((({type:e,element:t,callback:a})=>{this._boundEvents.push({type:e,element:t,callback:a.bind(this)})})))}setAttributes(e){if(void 0!==this.props.attributes)return this.props.attributes.forEach((t=>{let a=e;"root"!==t.element&&(a=e.querySelector(t.element)),null!==a&&Object.keys(t).forEach((e=>{if("element"!==e)if("className"===e){const s=t[e]?.type,n=t[e]?.value;void 0!==s&&void 0!==n&&a.classList[s](n)}else{const s=t[e],{type:n,value:i}=s;"set"===n?a.setAttribute(e,i):"remove"===n&&a.removeAttribute(e)}}))})),e}_render(){const e=this.render();e.length&&(this._element.innerHTML="",this._element.append(...e)),this.removeEvents(),this.setAttributes(this._element),this.addEvents(),this.afterRender()}forceUpdate(){this.eventBus.emit(r.INIT)}afterRender(){}}},1422:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{constructor(e,t){super(e,t),this.props.components&&Object.keys(this.props.components).forEach((e=>{if(void 0!==this.props.components){const t=this.props.components[e];Array.isArray(t)?t.forEach((e=>{e.setProps({checkFormValid:this.checkFormValid.bind(this)})})):t.setProps({checkFormValid:this.checkFormValid.bind(this)})}}))}get submitButton(){return this.element.querySelector("button")}checkFormValid(){const e=this.element.querySelectorAll("input");let t=!0;e.forEach((e=>{t="true"===e.dataset.valid&&t})),t?(this.submitButton.classList.remove("disabled"),this.submitButton.removeAttribute("disabled")):(this.submitButton.classList.add("disabled"),this.submitButton.setAttribute("disabled","true"))}}t.default=i},1804:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='error-page-wrap'>\n    <h1 class='title'>{{error.code}}</h1>\n    <h3 class='message'>{{error.message}}</h3>\n    <a data-path=\"/\" class='link'>К чатам</a>\n  </div>"},3204:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3137));class i extends n.default{}t.default=i},531:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='form login-wrap'>\n    <h1>Log in</h1>\n    <form>\n      <div data-component='loginInput'></div>\n      <div data-component='passwordInput'></div>\n      <div data-component='submitButton'></div>\n    </form>\n    <div class='pre-link'>Don't have an account? <a data-path='/sign-up' class='link'> Sign up</a></div>\n  </div>"},8071:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.loginProps=t.Login=t.submitButton=void 0;const n=s(a(5628)),i=s(a(4169)),r=s(a(9508)),l=s(a(9165)),o=s(a(4977)),d=s(a(1422)),u=a(3607),c=s(a(2707)),p=s(a(959)),f=new n.default({label:"Login",type:"text",name:"login",errorText:"Wrong login",events:[{type:"blur",element:"input",callback(e){const t=e.target,{isValid:a}=new o.default(t.value).minLength(4);a?f.setValid():f.setValidError()}}]},i.default),h=new n.default({label:"Password",type:"password",name:"password",errorText:"Wrong password",events:[{type:"blur",element:"input",callback(){h.setValid()}}]},i.default);t.submitButton=new r.default({attributes:[{element:"root",disabled:{type:"set",value:!0},className:{type:"add",value:"disabled"}}],type:"submit",text:"Login"},l.default);class m extends d.default{}t.Login=m,t.loginProps={events:[{type:"submit",element:"form",callback(e){const t=e.target;e.preventDefault(),c.default.signIn((0,p.default)(new FormData(t))),t.reset()}},{type:"click",element:"[data-path]",callback(e){const t=e.target,{path:a}=t.dataset;u.router.go(a)}}],components:{loginInput:f,passwordInput:h,submitButton:t.submitButton}}},7466:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(4858)),i=s(a(365)),r=s(a(3222)),l=s(a(1425)),o=s(a(4752)),d=s(a(5433)),u=s(a(9101)),c=a(525);t.default=`\n  <div class='chat-wrap'>\n    <div class='chat-list-wrap'>\n      <div class='controls-wrap'>\n        <button class='img-btn'>\n          <img data-path='/settings' src='${u.default}' alt='' />\n        </button>\n        <div class='search-input-wrap'>\n          <div data-component='searchInput'></div>\n        </div>\n        <button class='add-chat-btn img-btn'>\n          <img src='${n.default}' alt='' />\n        </button>\n      </div>\n      <div class='chat-list'>\n        <div data-component='chatList'></div>\n      </div>\n    </div>\n    <div class='chat-content-wrap hidden'>\n      <div class='header'>\n        <div class='chat-header'>\n          <div class='chat-img {{activeChatAvatar}}'><img src="${c.resourcesUrl}{{activeChat.avatar}}" alt=""></div>\n          <div class='chat-name'>{{activeChat.title}}</div>\n        </div>\n        <button class='settings-btn img-btn'>\n          <div class="settings-popup hidden">\n             <div data-action="chatUserList" class="item">\n               <div class="img-btn"><img src=${l.default} alt=""></div>\n               <div>Список пользователей</div>\n            </div>\n             <div data-action="chatAvatarUpdate" class="item">\n               <div class="img-btn"><img src=${o.default} alt=""></div>\n               <div>Изменить аватар чата</div>\n            </div>\n             <div data-action="deleteChat" class="item">\n               <div class="img-btn"><img src=${d.default} alt=""></div>\n               <div>Удалить чат</div>\n            </div>\n          </div>\n          <img src='${i.default}' alt='' />\n        </button>\n      </div>\n      <div class='content'>\n        <div class='messages'>\n          <div data-component='messages'></div>\n        </div>\n      </div>\n      <div class='controls'>\n        <button class='attach-btn img-btn'>\n          <img src='${r.default}' alt='' />\n        </button>\n        <div data-component='messageInput'></div>\n        <div data-component='arrowBtn'></div>\n      </div>\n    </div>\n    <div class='empty-chat'>Select chat to start messaging</div>\n  </div>`},780:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.messengerProps=t.Messenger=void 0;const n=s(a(3137)),i=s(a(6092)),r=s(a(1197)),l=s(a(5628)),o=s(a(4169)),d=s(a(4856)),u=a(3607),c=s(a(2734)),p=s(a(3703)),f=s(a(3307)),h=s(a(959)),m=s(a(3365)),v=s(a(9508)),g=s(a(9165)),_=s(a(7197)),b=s(a(8854)),y=s(a(2622)),w=s(a(581)),C=s(a(5223)),k=s(a(357)),M=s(a(2824)),P=s(a(283)),O=s(a(9099)),D=new i.default({},r.default);class j extends n.default{sendMessage(e){this.props.socket.send(JSON.stringify({content:(0,P.default)(e),type:"message"}))}componentDidMount(){c.default.getChats(0,20)}render(){const e=this.props.chats.map((e=>new _.default({},(0,b.default)(e))));return y.default.getCompiledChildren(this._meta.tmpl,{...this.props,activeChatAvatar:m.default.activeChat.avatar?"":"empty",components:{...this.props.components,chatList:e}})}afterRender(){m.default.activeChat?.id||(this.element.querySelector(".empty-chat")?.classList.remove("hidden"),this.element.querySelector(".chat-content-wrap")?.classList.add("hidden"))}}t.Messenger=j,t.messengerProps={chats:[],chatAvatarClass:"empty",events:[{type:"click",element:"[data-path]",callback(e){const t=e.target,{path:a}=t.dataset;u.router.go(a)}},{type:"click",element:".settings-btn",callback(){document.querySelector(".settings-popup")?.classList.toggle("hidden")}},{type:"click",element:".add-chat-btn",callback(){!function(){const e=new v.default({type:"submit",text:"create"},g.default),t=new l.default({label:"Chat name",type:"text",name:"title",errorText:"Wrong chat name",events:[{type:"blur",element:"input",callback(){t.setValid()}}]},o.default),a=new p.default({title:"Create chat",components:{formElements:[t,e]},events:[{type:"submit",element:"form",callback(e){e.preventDefault(),c.default.createChat((0,h.default)(new FormData(e.target)).title),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},f.default);document.body.append(a.getContent())}()}},{type:"click",element:".controls .arrow-button",callback(){this.sendMessage(this.element.querySelector(".controls input").value),this.element.querySelector(".controls input").value="",c.default.getChats()}},{type:"click",element:"[data-action]",callback(e){const t=e.currentTarget,{action:a}=t.dataset;"deleteChat"===a?function(e){const t=new v.default({type:"submit",text:"delete"},g.default),a=new p.default({title:`Confirm deleting chat ${e.title}`,components:{formElements:[t]},events:[{type:"submit",element:"form",callback(t){t.preventDefault(),c.default.deleteChat(e.id),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},f.default);document.body.append(a.getContent())}(m.default.activeChat):"chatAvatarUpdate"===a?function(e){const t=new v.default({type:"submit",text:"update"},g.default),a=new l.default({type:"hidden",name:"chatId",value:e},o.default),s=new l.default({label:"",type:"file",name:"avatar"},o.default),n=new p.default({title:"Update chat avatar",components:{formElements:[a,s,t]},events:[{type:"submit",element:"form",callback(e){e.preventDefault(),c.default.updateChatAvatar(new FormData(e.target)),this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},f.default);document.body.append(n.getContent())}(m.default.activeChat.id):"chatUserList"===a&&document.body.append(M.default.getContent())}},{type:"click",element:".chat",callback(e){const t=e.currentTarget,{id:a}=t.dataset;void 0!==a&&+a!==m.default.activeChat.id&&(this.props.socket&&(this.props.socket.close(),m.default.activeChatMessages=[]),m.default.activeChat=m.default.chats.find((e=>e.id===+a)),c.default.getChatUsersById(+a),w.default.getToken(+a).then((e=>{console.log(JSON.parse(e.response));const{token:t}=JSON.parse(e.response),s=C.default.startChat(m.default.userData.id,+a,t);let n;s.addEventListener("open",(()=>{n=window.setInterval((()=>{s.send(JSON.stringify({type:"ping"}))}),2e3),c.default.getNewMessagesCount(m.default.activeChat.id).then((e=>JSON.parse(e.response))).then((e=>{s.send(JSON.stringify({content:e.unread_count,type:"get old"}))}))})),s.onmessage=e=>{const t=(0,O.default)(JSON.parse(e.data));if("pong"===t.type)return;const a=m.default.activeChatMessages.concat(t);a.sort(((e,t)=>+new Date(e.time)-+new Date(t.time))),m.default.activeChatMessages=a},s.addEventListener("close",(e=>{e.wasClean?console.log("Соединение закрыто чисто"):console.log("Обрыв соединения"),clearInterval(n),console.log(`Код: ${e.code} | Причина: ${e.reason}`)})),this.setProps({socket:s})})),this.setProps({activeChatAvatar:m.default.activeChat.avatar?"":"empty",attributes:[{element:".empty-chat",className:{type:"add",value:"hidden"}},{element:".chat-content-wrap",className:{type:"remove",value:"hidden"}}]}))}}],components:{messages:k.default,searchInput:new l.default({},d.default),messageInput:new l.default({attributes:[{element:"root",className:{type:"add",value:"fullwidth"}}]},o.default),arrowBtn:D}}},993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='profile-wrap'>\n    <div class='sidebar'>\n      <div data-component='arrowBtn'></div>\n    </div>\n    <div class='profile'>\n      <div class='img-wrap'>\n        <img data-field='avatar' src='https://ya-praktikum.tech/api/v2/resources/{{userData.avatar}}' alt='avatar' class='profile-img'>\n      </div>\n      <h3>{{userData.display_name}}</h3>\n      <div class='row'>\n        <p data-field='email' class='field-name'>Email</p>\n        <p class='field-value'>{{userData.email}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='login' class='field-name'>Login</p>\n        <p class='field-value'>{{userData.login}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='password' class='field-name'>Password</p>\n        <p class='field-value'>••••••••••••</p>\n      </div>\n      <div class='row'>\n        <p data-field='first_name' class='field-name'>First name</p>\n        <p class='field-value'>{{userData.first_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='second_name' class='field-name'>Second name</p>\n        <p class='field-value'>{{userData.second_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='display_name' class='field-name'>Display name</p>\n        <p class='field-value'>{{userData.display_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='phone' class='field-name'>Phone number</p>\n        <p class='field-value'>{{userData.phone}}</p>\n      </div>\n      <a data-logout class='link warning'>log out</a>\n    </div>\n  </div>"},2448:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.profileProps=t.Profile=void 0;const n=s(a(6092)),i=s(a(1197)),r=s(a(3137)),l=a(3607),o=s(a(3307)),d=s(a(5628)),u=s(a(4169)),c=s(a(9508)),p=s(a(9165)),f=a(4977),h=s(a(2707)),m=s(a(3365)),v=s(a(2209)),g=s(a(959)),_=s(a(3703)),b=new n.default({attributes:[{element:"root",className:{type:"add",value:"to-left"}},{element:"root","data-path":{type:"set",value:"/"}}],events:[{type:"click",element:"root",callback(e){const t=e.target,{path:a}=t.dataset;l.router.go(a)}}]},i.default);class y extends r.default{componentDidMount(){h.default.getUser()}}t.Profile=y,t.profileProps={components:{arrowBtn:b},events:[{type:"click",element:"[data-field]",callback(e){!function(e){const{userData:t}=m.default,a=t[e],s="password"===e||"avatar"===e;let n={};const i=new c.default({type:"submit",text:"confirm edit"},p.default);if(s){if("password"===e){const t=new d.default({label:"Old password",type:"password",name:"oldPassword",errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(a){const s=a.target;(0,f.checkValidationByTemplate)(e,s.value),t.setValid()}}]},u.default),a=new d.default({label:"New password",type:"password",name:"newPassword",errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(t){const s=t.target;(0,f.checkValidationByTemplate)(e,s.value),a.setValid()}}]},u.default);n={formElements:[t,a,i]}}else if("avatar"===e){const t=new d.default({label:e.charAt(0).toUpperCase()+e.slice(1),type:"file",name:e,errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(a){const s=a.target;(0,f.checkValidationByTemplate)(e,s.value),t.setValid()}}]},u.default);n={formElements:[t,i]}}}else{const t=new d.default({label:e.charAt(0).toUpperCase()+e.slice(1),type:"text",value:a,name:e,errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback(a){const s=a.target;(0,f.checkValidationByTemplate)(e,s.value),t.setValid()}}]},u.default);n={formElements:[t,i]}}const r=new _.default({title:"Редактировать поле",components:n,events:[{type:"submit",element:"form",callback(t){if(t.preventDefault(),s)if("password"===e){const{oldPassword:e,newPassword:a}=(0,g.default)(new FormData(t.target));v.default.updateUserPassword(e,a)}else"avatar"===e&&v.default.updateProfileAvatar(new FormData(t.target)).then((()=>{h.default.getUser()})).catch((()=>{alert(`Не удалось обновить поле ${e}`)}));else{const a={...m.default.userData,...(0,g.default)(new FormData(t.target))};v.default.updateProfile(a).then((()=>{h.default.getUser()})).catch((()=>{alert(`Не удалось обновить поле ${e}`)}))}this.destroy()}},{type:"click",element:".close-popup",callback(){this.destroy()}}]},o.default);document.body.append(r.getContent())}(e.target.dataset.field)}},{type:"click",element:"[data-logout]",callback(){h.default.logout()}}]}},5394:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default="\n  <div class='form signup-wrap'>\n    <h1>Sign up</h1>\n    <form>\n      <div data-component='emailInput'></div>\n      <div data-component='loginInput'></div>\n      <div data-component='firstNameInput'></div>\n      <div data-component='secondNameInput'></div>\n      <div data-component='phoneInput'></div>\n      <div data-component='passwordInput'></div>\n      <div data-component='passwordAgainInput'></div>\n      <div data-component='submitBtn'></div>\n    </form>\n    <div class='pre-link'>Already have an account? <a data-path='/login' class='link'> Log in</a></div>\n  </div>"},5170:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.signupProps=t.Signup=void 0;const n=s(a(5628)),i=s(a(9508)),r=s(a(9165)),l=s(a(4169)),o=s(a(4977)),d=a(3607),u=s(a(1422)),c=s(a(2707)),p=s(a(959)),f=new n.default({label:"Email",type:"text",name:"email",errorText:"Wrong email",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value),{isValid:s}=a.email();s?f.setValid():f.setValidError()}}]},l.default),h=new n.default({label:"Login",type:"text",name:"login",errorText:"Wrong login",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value),{isValid:s}=a.minLength(4).lettersOrNumbers();s?h.setValid():h.setValidError()}}]},l.default),m=new n.default({label:"First name",type:"text",name:"first_name",errorText:"Wrong first name",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value),{isValid:s}=a.minLength(2).onlyLetters();s?m.setValid():m.setValidError()}}]},l.default),v=new n.default({label:"Second name",type:"text",name:"second_name",errorText:"Wrong second name",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value),{isValid:s}=a.minLength(2).onlyLetters();s?v.setValid():v.setValidError()}}]},l.default),g=new n.default({label:"Phone number",type:"number",name:"phone",errorText:"Wrong phone number",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value),{isValid:s}=a.phone();s?g.setValid():g.setValidError()}}]},l.default),_=new n.default({label:"Password",type:"password",name:"password",errorText:"Wrong password",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value),{isValid:s}=a.minLength(6).lettersOrNumbers();s?_.setValid():_.setValidError()}}]},l.default),b=new n.default({label:"Password (again)",type:"password",name:"passwordAgain",errorText:"Password mismatch",events:[{type:"blur",element:"input",callback(e){const t=e.target,a=new o.default(t.value);let{isValid:s}=a.minLength(6).lettersOrNumbers();const n=document.querySelector("[name=password]");null!==n&&(s=s&&n.value===t.value),s?b.setValid():b.setValidError()}}]},l.default),y=new i.default({attributes:[{element:"root",disabled:{type:"set",value:!0},className:{type:"add",value:"disabled"}}],type:"submit",text:"Sign up"},r.default);class w extends u.default{}t.Signup=w,t.signupProps={events:[{type:"submit",element:"form",callback(e){e.preventDefault(),c.default.signUp((0,p.default)(new FormData(e.target)))}},{type:"click",element:"[data-path]",callback(e){const t=e.target,{path:a}=t.dataset;d.router.go(a)}}],components:{emailInput:f,loginInput:h,firstNameInput:m,secondNameInput:v,phoneInput:g,passwordInput:_,passwordAgainInput:b,submitBtn:y}}},3365:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.storeEventBus=t.storeUserInitial=void 0;const n=s(a(3460)),i=s(a(5906)),r=a(525);t.storeUserInitial={updateMessenger:!1,userData:{id:null,first_name:"",second_name:"",login:"",email:"",phone:"",display_name:"",avatar:r.defaultAvatar},chats:[],activeChat:{},searchUserInput:"",activeChatUsers:[],searchUserList:[],activeChatMessages:[],activeChatAvatar:""};const l=t.storeUserInitial;t.storeEventBus=new n.default;const o=new Proxy(l,{get:(e,t)=>{const a=e[t];return"function"==typeof a?a.bind(e):a},set:(e,a,s)=>((0,i.default)(s)?e[a]={...s}:e[a]=s,t.storeEventBus.emit(a,{...o}),!0)});t.default=o},3460:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=class{listeners;constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]=this.listeners[e].filter((e=>e!==t))}emit(e,...t){this.listeners[e]&&this.listeners[e].forEach((e=>{e(...t)}))}}},4376:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(3739));t.default=class{url;constructor(e){this.url=e}get=(e,t={})=>this.request(e,{...t,method:"GET"},t.timeout);post=(e,t={})=>this.request(e,{...t,method:"POST"},t.timeout);put=(e,t={})=>this.request(e,{...t,method:"PUT"},t.timeout);delete=(e,t={})=>this.request(e,{...t,method:"DELETE"},t.timeout);request=(e,t={},a=5e3)=>{const{headers:s={},method:i,data:r,withCredentials:l}=t;return new Promise(((t,o)=>{if(!i)return void o(new Error("No method"));const d=new XMLHttpRequest,u="GET"===i;d.withCredentials=!!l,d.open(i,u&&r?`${this.url+e}${(0,n.default)(r)}`:this.url+e),Object.keys(s).forEach((e=>{d.setRequestHeader(e,s[e])})),d.onload=()=>{d.status>=200&&d.status<300?t(d):d.status>=400&&d.status<500&&o(d)},d.onabort=o,d.onerror=o,d.timeout=a,d.ontimeout=o,u||!r?d.send():d.send(r)}))}}},6055:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(2843));t.default=class{pathname;_block;_props;init=!1;isProtected;constructor(e,t,a,s){this.pathname=e,this._block=t,this._props=a,this.isProtected=s}navigate(e){e===this.pathname&&(this.pathname=e,this.render())}leave(){this._block.destroy()}render(){if(!this.init)return(0,n.default)(this._props.rootQuery,this._block),void(this.init=!0);this._block.create(),(0,n.default)(this._props.rootQuery,this._block)}}},8320:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(6055)),i=s(a(2707));class r{static __instance;routes=[];history=window.history;_currentRoute=null;_rootQuery="";constructor(e){if(r.__instance)return r.__instance;this._rootQuery=e,r.__instance=this}use(e,t,a){const s=new n.default(e,t,{rootQuery:this._rootQuery},a);return this.routes.push(s),this}getCurrentRoute(){return this._currentRoute}start(){window.onpopstate=e=>{if(null!==e.currentTarget){const t=e.currentTarget;this._onRoute(t.location.pathname)}},this._onRoute(window.location.pathname)}_onRoute(e){const t=this.getRoute(e)??this.getRoute("errorPage");this._currentRoute&&this._currentRoute.leave(),t.isProtected?i.default.checkUserLoggedIn().then((()=>{this._currentRoute=t,t.render()})).catch((()=>{this.go("/login")})):(this._currentRoute=t,t.render())}go(e){this.history.pushState({},"",e),this._onRoute(e)}back(){this.history.back()}forward(){this.history.forward()}getRoute(e){return this.routes.find((t=>t.pathname===e))}}t.default=r},2622:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(4036)),i={compile(e,t={}){let a=e;return Array.from(e.matchAll(/{{(.*?)}}/gi)).forEach((e=>{const s=e[1].trim(),i=(0,n.default)(t,s);let r;if(s.includes(".time")){const e=new Date(i),t=new Date;r=e.toDateString()===t.toDateString()?new Date(i).toLocaleTimeString().slice(0,-3):new Date(i).toLocaleDateString()}else r=null==i?"":i;a=a.replace(new RegExp(e[0],"gi"),r)})),a},getCompiledParent(e,t){const a=this.compile(e,t),s=(new DOMParser).parseFromString(a,"text/html").body.children[0];return s.children.length&&(s.innerHTML=""),s},getCompiledChildren(e,t){return this.compileToHtml(e,t).children},compileToHtml(e,t){let a=e;a=this.compile(a,t);const s=(new DOMParser).parseFromString(a,"text/html").body.children[0];return t.components&&s.querySelectorAll("[data-component]").forEach((e=>{if(void 0!==t.components&&e instanceof HTMLElement){const a=t.components[e.dataset.component];if(void 0!==a)if(Array.isArray(a)){const t=document.createDocumentFragment();t.append(...a.map((e=>e.getContent()))),e.replaceWith(t)}else e.replaceWith(a.getContent())}})),s}};t.default=i},4977:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.checkValidationByTemplate=void 0;const a=/^[a-z]+$/i,s=/^\d+$/,n=/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/,i=/^\S+@\S+\.\S+$/,r=/[0-9]/;class l{isValid=!0;value;constructor(e){this.value=e}email(){return this.isValid=i.test(this.value)&&this.isValid,this}required(){return this.isValid=!!this.value.length&&this.isValid,this}maxLength(e){return this.isValid=this.value.length<=e&&this.isValid,this}minLength(e){return this.isValid=this.value.length>=e&&this.isValid,this}onlyLetters(){return this.isValid=a.test(this.value)&&this.isValid,this}onlyNumbers(){return this.isValid=s.test(this.value)&&this.isValid,this}phone(){return this.isValid=n.test(this.value)&&this.isValid,this}lettersOrNumbers(){return this.isValid=r.test(this.value)&&this.isValid,this}}t.checkValidationByTemplate=function(e,t){const a=new l(t);let s;switch(e){case"email":s=a.email().isValid;break;case"login":s=a.minLength(4).lettersOrNumbers().isValid;break;case"first_name":case"second_name":s=a.minLength(2).onlyLetters().isValid;break;case"phone":s=a.phone().isValid;break;case"password":s=a.minLength(6).lettersOrNumbers().isValid;break;default:s=!1}return s},t.default=l},9099:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(5906)),i=s(a(283));t.default=function e(t){let a=t;if("string"==typeof t&&(a=(0,i.default)(t)),Array.isArray(t)&&(a=t.map((t=>e(t)))),(0,n.default)(t)){a={};for(const s in t)t.hasOwnProperty(s)&&(t instanceof Array||(a[s]=e(t[s])))}return a}},283:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/"/g,"&quot;")}},4036:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(5906));t.default=function(e,t,a){const s=t.split(".");let i=e[s[0]];if(void 0===i)return i;if((0,n.default)(i))for(let e=1;e<s.length;e++){if(void 0===i[s[e]]){i=a||void 0;break}i=i[s[e]]}return i}},959:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){const t={};return e.forEach(((e,a)=>{t[a]=e})),t}},5906:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return"object"==typeof e&&null!==e&&e.constructor===Object&&"[object Object]"===Object.prototype.toString.call(e)}},3739:function(e,t,a){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const n=s(a(5906));function i(e){return(0,n.default)(e)||Array.isArray(e)}function r(e,t){return t?`${t}[${e}]`:e}function l(e,t){const a=[];for(const[s,n]of Object.entries(e))i(n)?a.push(...l(n,r(s,t))):a.push([r(s,t),encodeURIComponent(String(n))]);return a}t.default=function(e){if(!(0,n.default)(e))throw new Error("input must be an object");return l(e).map((e=>e.join("="))).join("&")}},2843:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){document.querySelector(e).append(t.getContent())}},1427:(e,t,a)=>{e.exports=a.p+"f8bf1d63e04127e947a8.svg"},3222:(e,t,a)=>{e.exports=a.p+"7af5e6bbd0d68666fb20.svg"},4752:(e,t,a)=>{e.exports=a.p+"579d3edc708246a93204.svg"},7114:(e,t,a)=>{e.exports=a.p+"6da2c4d81791b3e598cb.svg"},365:(e,t,a)=>{e.exports=a.p+"044146fe2c14a0e83def.svg"},4858:(e,t,a)=>{e.exports=a.p+"f2629328aa28ff0d01e3.svg"},5988:(e,t,a)=>{e.exports=a.p+"c7d3d697c63649fd9f44.svg"},4583:(e,t,a)=>{e.exports=a.p+"74440aa1ceef6f2cf27b.svg"},9101:(e,t,a)=>{e.exports=a.p+"d1ee6736dc93b29c0e2a.svg"},5433:(e,t,a)=>{e.exports=a.p+"9174b55dda406c4f7e18.svg"},1425:(e,t,a)=>{e.exports=a.p+"dd1ebe1083b3a66d7e00.svg"}},t={};function a(s){var n=t[s];if(void 0!==n)return n.exports;var i=t[s]={exports:{}};return e[s].call(i.exports,i,i.exports,a),i.exports}a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;a.g.importScripts&&(e=a.g.location+"");var t=a.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var s=t.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=e})(),a(3607)})();
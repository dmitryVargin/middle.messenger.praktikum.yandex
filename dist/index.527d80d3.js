function e(e){return e&&e.__esModule?e.default:e}var{v4:t}=require("uuid");class n{constructor(){this.listeners={}}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}off(e,t){this.listeners[e]=this.listeners[e].filter((e=>e!==t))}emit(e,...t){if(!this.listeners[e])throw new Error(`Нет события: ${e}`);this.listeners[e].forEach((e=>{e(...t)}))}}function s(e,t,n){const s=t.split(".");let a=e[s[0]];if(void 0===a)return a;for(let e=1;e<s.length;e++){if(void 0===a[s[e]]){a=n||void 0;break}a=a[s[e]]}return a}function a(e){return null===e||("string"==typeof e?0===e.length:"object"!=typeof e||(void 0!==e.size?0===e.size:Array.isArray(e)?0===e.length:0===Object.keys(e).length))}const i={compile:function(e,t={}){let n=null;const i=/{{(.*?)}}/gi;let l=e;for(;n=i.exec(l);)if(n[1]){const e=s(t,n[1].trim()),i=a(e)?"":e;l=l.replace(new RegExp(n[0],"gi"),i)}return l},compilePassEmpty:function(e,t={}){let n=null;const i=/{{(.*?)}}/gi;let l=e;for(;n=i.exec(l);)if(n[1]){const e=s(t,n[1].trim()),i=a(e)?"":e;e&&(l=l.replace(new RegExp(n[0],"gi"),i))}return l},getCompiledParent:function(e,t){const n=this.compile(e,t),s=(new DOMParser).parseFromString(n,"text/html").body.children[0];return s.children.length&&(s.innerHTML=""),s},getCompiledChildren:function(e,t){return this.compileToHtml(e,t).children},compileToHtml:function(e,t){let n=e;n=this.compile(n,t);const s=(new DOMParser).parseFromString(n,"text/html").body.children[0];return t.components&&s.querySelectorAll("[data-component]").forEach((e=>{if(void 0!==t.components&&e instanceof HTMLElement){const n=t.components[e.dataset.component];void 0!==n&&(Array.isArray(n)?e.replaceWith(...n.map((e=>e.getContent()))):e.replaceWith(n.getContent()))}})),s},compileConcat:function(e){let t="";return e.forEach((e=>{t+=i.compile(e.template,e.context)})),t}};var l,o;(o=l||(l={})).INIT="init",o.FLOW_CDM="flow:component-did-mount",o.FLOW_CDU="flow:component-did-update",o.FLOW_RENDER="flow:render";class r{constructor(e={},s){this._boundEvents=[],this.eventBus=new n,this._meta={tmpl:s,props:e},this.props=this._makePropsProxy({...e,__id:this._id}),this.props.withInternalId&&(this._id=t()),this._registerEvents(),this.eventBus.emit(l.INIT)}get element(){return this._element}destroyElem(){this.element.remove()}getContent(){return this.element}setProps=e=>{e&&Object.assign(this.props,{...e})};render(){return i.getCompiledChildren(this._meta.tmpl,this.props)}componentDidMount(){}init(){this._createResources(),this.eventBus.emit(l.FLOW_CDM)}componentDidUpdate(e,t){return e!==t}show(){this.getContent().classList.remove("hidden")}hide(){this.getContent().classList.add("hidden")}_registerEvents(){this.eventBus.on(l.INIT,this.init.bind(this)),this.eventBus.on(l.FLOW_CDM,this._componentDidMount.bind(this)),this.eventBus.on(l.FLOW_CDU,this._componentDidUpdate.bind(this)),this.eventBus.on(l.FLOW_RENDER,this._render.bind(this))}_createResources(){const e=i.getCompiledParent(this._meta.tmpl,this.props);this._id&&(e.dataset.id=this._id),this._element=e}_makePropsProxy(e){return new Proxy(e,{get:(e,t)=>{const n=e[t];return"function"==typeof n?n.bind(e):n},set:(e,t,n)=>("object"==typeof e[t]?Object.assign(e[t],n):e[t]=n,this.eventBus.emit(l.FLOW_CDU,{...e},e),!0),deleteProperty:()=>{throw new Error("Нет доступа")}})}_componentDidMount(){this.componentDidMount(),this.eventBus.emit(l.FLOW_RENDER)}_componentDidUpdate(e,t){this.componentDidUpdate(e,t)&&this._render()}addEvents(){this._boundEvents.forEach((({type:e,element:t,callback:n})=>{if(t)if("root"===t){this.element.addEventListener(e,n)}else{this.element.querySelectorAll(t).forEach((t=>{t.addEventListener(e,n)}))}}))}removeEvents(){this._boundEvents.forEach((({type:e,element:t,callback:n})=>{if(t){let s;s="root"===t?this.element:this.element.querySelector(t),s.removeEventListener(e,n)}})),this.props.events&&(this._boundEvents=[],this.props.events.forEach((({type:e,element:t,callback:n})=>{this._boundEvents.push({type:e,element:t,callback:n.bind(this)})})))}setAttributes(e){return void 0!==this.props.attributes&&this.props.attributes.forEach((t=>{let n=e;"root"!==t.element&&(n=e.querySelector(t.element)),null!==n&&Object.keys(t).forEach((e=>{if("element"!==e)if("className"===e){var s,a;const i=null===(s=t[e])||void 0===s?void 0:s.type,l=null===(a=t[e])||void 0===a?void 0:a.value;void 0!==i&&void 0!==l&&n.classList[i](l)}else{const s=t[e],{type:a}=s,{value:i}=s;"set"===a?n.setAttribute(e,i):"remove"===a&&n.removeAttribute(e)}}))})),e}_render(){const e=this.render();e.length&&(this._element.innerHTML="",this._element.append(...e)),this.removeEvents(),this.setAttributes(this._element),this.addEvents()}}class c extends r{get input(){return this.element.querySelector("input")}setValidError(){var e;this.input.dataset.valid="false",null===(e=this.element.querySelector("[data-validation-error]"))||void 0===e||e.classList.add("visible"),this.props.checkFormValid()}setValid(){var e;this.input.dataset.valid="true",null===(e=this.element.querySelector("[data-validation-error]"))||void 0===e||e.classList.remove("visible"),this.props.checkFormValid()}}var d="\n  <div class='input-wrap'>\n    <span class='label'>{{label}}</span>\n    <input data-valid='false' placeholder='{{placeholder}}' name='{{name}}' class='input' type='{{type}}'/>\n    <span data-validation-error class='error'>{{errorText}}</span>\n  </div>";class p extends r{get button(){return this.element.querySelector("button")}}const m=/^[a-z]+$/i,u=/^\d+$/,v=/^(\s*)?(\+)?([- _():=+]?\d[- _():=+]?){10,14}(\s*)?$/,h=/^\S+@\S+\.\S+$/,g=/[0-9]/;class b{isValid=!0;constructor(e){this.value=e}email(){return this.isValid=h.test(this.value)&&this.isValid,this}required(){return this.isValid=!!this.value.length&&this.isValid,this}maxLength(e){return this.isValid=this.value.length<=e&&this.isValid,this}minLength(e){return this.isValid=this.value.length>=e&&this.isValid,this}onlyLetters(){return this.isValid=m.test(this.value)&&this.isValid,this}onlyNumbers(){return this.isValid=u.test(this.value)&&this.isValid,this}phone(){return this.isValid=v.test(this.value)&&this.isValid,this}lettersOrNumbers(){return this.isValid=g.test(this.value)&&this.isValid,this}}class f extends r{constructor(e,t){super(e,t),this.props.components&&Object.keys(this.props.components).forEach((e=>{if(void 0!==this.props.components){this.props.components[e].setProps({checkFormValid:this.checkFormValid.bind(this)})}}))}get submitButton(){return this.element.querySelector("button")}checkFormValid(){const e=this.element.querySelectorAll("input");let t=!0;e.forEach((e=>{t="true"===e.dataset.valid&&t})),t?(this.submitButton.classList.remove("disabled"),this.submitButton.removeAttribute("disabled")):(this.submitButton.classList.add("disabled"),this.submitButton.setAttribute("disabled","true"))}}function w(e,t){const n=e.target,{path:s}=n.dataset;"string"==typeof s&&(window.history.pushState({},s,`${window.location.origin}${s}`),void 0!==t&&t())}const y=new c({label:"Login",type:"text",name:"login",errorText:"Wrong login",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,{isValid:n}=new b(t.value).minLength(4);n?y.setValid():y.setValidError()}}]},d),_=new c({label:"Password",type:"password",name:"password",errorText:"Wrong password",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.minLength(6).lettersOrNumbers();s?_.setValid():_.setValidError()}}]},d),k=new p({attributes:[{element:"root",disabled:{type:"set",value:!0},className:{type:"add",value:"disabled"}}],type:"submit",text:"Login"},"<button type='{{type}}' class='button'>{{text}}</button>");const E={events:[{type:"submit",element:"form",callback:function(e){e.preventDefault();const t=new FormData(e.target),n={};for(const[e,s]of t)n[e]=s;console.log(n)}},{type:"click",element:"[data-path]",callback:function(e){w(e,ae)}}],components:{loginInput:y,passwordInput:_,submitButton:k}};const V=new c({label:"Email",type:"text",name:"email",errorText:"Wrong email",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.email();s?V.setValid():V.setValidError()}}]},d),L=new c({label:"Login",type:"text",name:"login",errorText:"Wrong login",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.minLength(4).lettersOrNumbers();s?L.setValid():L.setValidError()}}]},d),x=new c({label:"First name",type:"text",name:"first_name",errorText:"Wrong first name",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.minLength(2).onlyLetters();s?x.setValid():x.setValidError()}}]},d),D=new c({label:"Second name",type:"text",name:"second_name",errorText:"Wrong second name",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.minLength(2).onlyLetters();s?D.setValid():D.setValidError()}}]},d),S=new c({label:"Phone number",type:"number",name:"phone",errorText:"Wrong phone number",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.phone();s?S.setValid():S.setValidError()}}]},d),M=new c({label:"Password",type:"password",name:"password",errorText:"Wrong password",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value),{isValid:s}=n.minLength(6).lettersOrNumbers();s?M.setValid():M.setValidError()}}]},d),I=new c({label:"Password (again)",type:"password",name:"passwordAgain",errorText:"Password mismatch",events:[{type:"blur",element:"input",callback:function(e){const t=e.target,n=new b(t.value);let{isValid:s}=n.minLength(6).lettersOrNumbers();const a=document.querySelector("[name=password]");null!==a&&(s=s&&a.value===t.value),s?I.setValid():I.setValidError()}}]},d),O=new p({attributes:[{element:"root",disabled:{type:"set",value:!0},className:{type:"add",value:"disabled"}}],type:"submit",text:"Sign up"},"<button type='{{type}}' class='button'>{{text}}</button>");const C={events:[{type:"submit",element:"form",callback:function(e){e.preventDefault();const t=new FormData(e.target),n={};for(const[e,s]of t)n[e]=s;console.log(n)}},{type:"click",element:"[data-path]",callback:function(e){w(e,ae)}}],components:{emailInput:V,loginInput:L,firstNameInput:x,secondNameInput:D,phoneInput:S,passwordInput:M,passwordAgainInput:I,submitBtn:O}};class $ extends r{}var P=null;var F=function(){return P||(P=function(){try{throw new Error}catch(t){var e=(""+t.stack).match(/(https?|file|ftp):\/\/[^)\n]+/g);if(e)return(""+e[0]).replace(/^((?:https?|file|ftp):\/\/.+)\/[^/]+$/,"$1")+"/"}return"/"}()),P};const N=`\n    <div class='arrow-button'>\n      <img src='${e(F()+"arrow.586565a4.svg")}' alt=''/>\n    </div>`;class T extends f{}const A=new $({attributes:[{element:"root",className:{type:"add",value:"to-left"}},{element:"root","data-path":{type:"set",value:"/chat"}}],events:[{type:"click",element:"root",callback:function(e){w(e,ae)}}]},N);function B(e){const t=new c({label:e.charAt(0).toUpperCase()+e.slice(1),type:"text",placeholder:"Some value from store",name:e,errorText:`Wrong ${e}`,events:[{type:"blur",element:"input",callback:function(n){const s=n.target;(function(e,t){const n=new b(t);let s;switch(e){case"email":s=n.email().isValid;break;case"login":s=n.minLength(4).lettersOrNumbers().isValid;break;case"first_name":case"second_name":s=n.minLength(2).onlyLetters().isValid;break;case"phone":s=n.phone().isValid;break;case"password":s=n.minLength(6).lettersOrNumbers().isValid;break;default:s=!1}return s})(e,s.value)?t.setValid():t.setValidError()}}]},d),n=new p({type:"submit",text:"confirm edit"},"<button type='{{type}}' class='button'>{{text}}</button>"),s=new T({title:"Редактировать поле",components:{input:t,submitBtn:n},events:[{type:"submit",element:"form",callback:function(e){e.preventDefault();const t=new FormData(e.target),n={};for(const[e,s]of t)n[e]=s;console.log(n),this.destroyElem()}},{type:"click",element:".close-popup",callback:function(){this.destroyElem()}}]},"\n  <div class='popup-wrap'>\n    <div class='popup'>\n    <div class='close-popup'>+</div>\n    <div class='title'>{{title}}</div>\n    <form>\n    <div data-component='input'></div>\n    <div data-component='submitBtn'></div>\n    </form>\n    </div>\n  </div>");document.body.append(s.getContent())}const q={components:{arrowBtn:A},events:[{type:"click",element:"[data-field]",callback:function(e){B(e.target.dataset.field)}},{type:"click",element:"[data-path]",callback:function(e){w(e,ae)}}]};var W=`\n  <div class='input-wrap'>\n  <img class='search-icon' src='${e(F()+"search.2964ddfb.svg")}' alt=''>\n    <span class='label'>{{label}}</span>\n    <input data-valid='false' name='{{name}}' class='input search' type='{{type}}'/>\n    <span data-validation-error class='error'>{{errorText}}</span>\n  </div>`;const H=[{messageId:123451,message:"Some message1",time:new Date,isOwn:!0},{messageId:2341,message:"Some message2",time:new Date,isOwn:!0},{messageId:12355451,message:"Some message3",time:new Date,isOwn:!0}],R=[{logo:"",name:"Андрей",lastMsgDate:new Date,unreadMsgCount:3,isLastMsgOwn:!0,lastMsg:"Some message"},{logo:"",name:"Андрей2",lastMsgDate:new Date,unreadMsgCount:6,isLastMsgOwn:!0,lastMsg:"Some message2"},{logo:"",name:"Андрей3",lastMsgDate:new Date,unreadMsgCount:5,isLastMsgOwn:!0,lastMsg:"Some message3"}],j=new c({},W),U=new c({attributes:[{element:"root",className:{type:"add",value:"fullwidth"}}]},d),z=new $({},N),J={messagesMock:H,chatMock:R};class G extends r{}function K(e){const t=J.messagesMock;e&&t.push({messageId:9999,message:e,time:new Date,isOwn:!0});const n=`<div>${t.map((e=>(({messageId:e,message:t,time:n,isOwn:s})=>`\n  <div data-id='${e}' class='message ${s?"own":"other"}'>\n    <p class='text'>\n    ${t}\n    </p>\n    <div class='info'>\n      <div class='time'>${n.getHours()}:${n.getMinutes()}</div>\n    </div>\n  </div>`)(e))).join()}</div>`;return new G({},n)}const Q=`<div>${J.chatMock.map((e=>(({logo:e,name:t,lastMsgDate:n,unreadMsgCount:s,isLastMsgOwn:a,lastMsg:i})=>`\n  <div class='chat'>\n    <div class='img'>${e}</div>\n    <div class='content'>\n      <div class='name'>${t}</div>\n      <div class='last-msg'>\n      ${a?"<span class='own-msg'>Вы:</span>":""}\n      ${i}\n      </div>\n      <div class='last-msg-date'>${n.getHours()}:${n.getMinutes()}</div>\n      <div class='unread-msg-count-wrap'>${s}</div>\n    </div>\n  </div>`)(e))).join()}</div>`,X=new class extends r{}({},Q);const Y={events:[{type:"click",element:"[data-path]",callback:function(e){w(e,ae)}},{type:"click",element:".controls .arrow-button",callback:function(){this.sendMessage(this.element.querySelector(".controls input").value),this.element.querySelector(".controls input").value=""}}],components:{searchInput:j,messageInput:U,arrowBtn:z}};var Z=`\n      <div class='chat-wrap'>\n        <div class='chat-list-wrap'>\n          <div class='controls-wrap'>\n            <button class='img-btn'>\n              <img data-path='/profile' src='${e(F()+"settings.99d08653.svg")}' alt='' />\n            </button>\n            <div class='search-input-wrap'>\n              <div data-component='searchInput'></div>\n            </div>\n            <button class='add-chat-btn img-btn'>\n              <img src='${e(F()+"plus.094c9006.svg")}' alt='' />\n            </button>\n          </div>\n          <div class='chat-list'>\n          <div data-component='chatList'></div>\n          </div>\n        </div>\n        <div class='chat-content-wrap hidden'>\n          <div class='header'>\n            <div class='chat-header'>\n              <div class='chat-img'></div>\n              <div class='chat-name'>{{chatName}}</div>\n            </div>\n            <button class='settings-btn img-btn'>\n              <img src='${e(F()+"dot-btn.0efa3fab.svg")}' alt='' />\n            </button>\n          </div>\n          <div class='content'>\n            <div class='message-date'>19 июня</div>\n            <div class='messages'>\n            <div data-component='messages'></div>\n           \n            </div>\n          </div>\n          <div class='controls'>\n            <button class='attach-btn img-btn'>\n              <img src='${e(F()+"attach.582e70ed.svg")}' alt='' />\n            </button>\n              <div data-component='messageInput'></div>\n              <div data-component='arrowBtn'></div>\n          </div>\n        </div>\n         <div class='empty-chat'>Select chat to start messaging</div>\n      </div>`;class ee extends r{}const te={"/login":{Class:class extends f{},props:E,value:null,tmpl:"\n  <div class='form login-wrap'>\n    <h1>Log in</h1>\n    <form>\n    <div data-component='loginInput'></div>\n    <div data-component='passwordInput'></div>\n    <div data-component='submitButton'></div>\n    </form>\n    <div class='pre-link'>Don't have an account? <a data-path='/signup' class='link'> Sign up</a></div>\n  </div>"},"/signup":{Class:class extends f{},props:C,value:null,tmpl:"\n  <div class='form signup-wrap'>\n    <h1>Sign up</h1>\n    <form>\n    <div data-component='emailInput'></div>\n    <div data-component='loginInput'></div>\n    <div data-component='firstNameInput'></div>\n    <div data-component='secondNameInput'></div>\n    <div data-component='phoneInput'></div>\n    <div data-component='passwordInput'></div>\n    <div data-component='passwordAgainInput'></div>\n     <div data-component='submitBtn'></div>\n    </form>\n    <div class='pre-link'>Already have an account? <a data-path='/login' class='link'> Log in</a></div>\n  </div>"},"/chat":{Class:class extends r{sendMessage(e){setTimeout((()=>{var t,n;this.setProps({components:{messages:K(e)}}),null===(t=document.querySelector(".empty-chat"))||void 0===t||t.classList.add("hidden"),null===(n=document.querySelector(".chat-content-wrap"))||void 0===n||n.classList.remove("hidden")}),100)}componentDidMount(){setTimeout((()=>{this.setProps({components:{chatList:X},events:[...this.props.events,{type:"click",element:".chat",callback:function(){var e,t;this.setProps({chatName:"Some chat",components:{messages:K()}}),null===(e=document.querySelector(".empty-chat"))||void 0===e||e.classList.add("hidden"),null===(t=document.querySelector(".chat-content-wrap"))||void 0===t||t.classList.remove("hidden")}}]})}),1e3)}},props:Y,value:null,tmpl:Z},"/profile":{Class:class extends r{componentDidMount(){setTimeout((()=>{this.setProps({userData:{avatar:"",email:"example@email.com",login:"some_login",first_name:"John",second_name:"Doe",display_name:"Johny",phone:"+7-123-456-78-90"}})}),1e3)}},props:q,value:null,tmpl:"\n  <div class='profile-wrap'>\n    <div class='sidebar'>\n    <div data-component='arrowBtn'></div>\n    </div>\n    <div class='profile'>\n      <div class='img-wrap'>\n        <img src='{{userData.avatar}}' alt='avatar' class='profile-img'>\n      </div>\n      <h3>Иван</h3>\n      <div class='row'>\n        <p data-field='email' class='field-name'>Email</p>\n        <p class='field-value'>{{userData.email}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='login' class='field-name'>Login</p>\n        <p class='field-value'>{{userData.login}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='password' class='field-name'>Password</p>\n        <p class='field-value'>••••••••••••</p>\n      </div>\n      <div class='row'>\n        <p data-field='first_name' class='field-name'>First name</p>\n        <p class='field-value'>{{userData.first_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='second_name' class='field-name'>Second name</p>\n        <p class='field-value'>{{userData.second_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='display_name' class='field-name'>Display name</p>\n        <p class='field-value'>{{userData.display_name}}</p>\n      </div>\n      <div class='row'>\n        <p data-field='phone' class='field-name'>Phone number</p>\n        <p class='field-value'>{{userData.phone}}</p>\n      </div>\n      <a data-path='/login' class='link warning' href='#'>log out</a>\n    </div>\n  </div>"}};function ne(){let e;if(void 0!==te[window.location.pathname]){const t=te[window.location.pathname];!!t.value||(t.value=new t.Class(t.props,t.tmpl)),e=t.value}else e=new ee({error:{code:"404",message:"Страница не существует"}},"\n  <div class='error-page-wrap'>\n    <h1 class='title'>{{error.code}}</h1>\n    <h3 class='message'>{{error.message}}</h3>\n    <a class='link'>Назад к чатам</a>\n  </div>");return e}exports.getCurrentPage=ne;const se=new class extends r{}({components:{navTmp:new class extends r{}({events:[{type:"click",element:"[data-path]",callback:function(e){w(e,(()=>{se.setProps({components:{page:ne()}})}))}}]},"\n  <nav>\n    <ul class='nav-list'>\n      <li><a data-path='/login' class='link'>login</a></li>\n      <li><a data-path='/signup' class='link'>signup</a></li>\n      <li><a data-path='/profile' class='link'>profile</a></li>\n      <li><a data-path='/errorPage' class='link'>errorPage</a></li>\n      <li><a data-path='/chat' class='link'>chat</a></li></ul>\n  </nav>"),page:ne()}},"\n   <main class='app'>\n     <div data-component='navTmp'></div>\n     <div class='page'>\n     <div data-component='page'></div>\n     </div>\n   </main>"),ae=()=>{se.setProps({components:{page:ne()}})};var ie,le;exports.appRerender=ae,ie="#root",le=se,document.querySelector(ie).append(le.getContent());
//# sourceMappingURL=index.527d80d3.js.map
